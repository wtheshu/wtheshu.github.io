<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="奇怪先生的博客"><title>Linux系统管理技巧（Aming） | 奇怪先生的博客</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux系统管理技巧（Aming）</h1><a id="logo" href="/.">奇怪先生的博客</a><p class="description">耳目得来终觉浅，觉知此事要躬行。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Linux系统管理技巧（Aming）</h1><div class="post-meta"><a href="/2017/12/01/Linux系统管理技巧（Aming）/#comments" class="comment-count"></a><p><span class="date">Dec 01, 2017</span><span><a href="/categories/Linux/" class="category">Linux</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><blockquote>
<p>开始</p>
</blockquote>
<h1 id="1-监控系统的状态"><a href="#1-监控系统的状态" class="headerlink" title="1. 监控系统的状态"></a>1. 监控系统的状态</h1><p>这一节是关于分析系统状态的各种工具，也是运维中常用到的工具。务必掌握。</p>
<h2 id="1-1-w-查看系统负载"><a href="#1-1-w-查看系统负载" class="headerlink" title="1.1. w 查看系统负载"></a>1.1. w 查看系统负载</h2><p>Linux系统管理员最常用的命令就是这个w了。用来查看系统整体上的负载，通过查看这些信息就可以知道当前系统有没有压力。其具体用法如下：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># w</span></div><div class="line"> 15:40:14 up 28 min,  1 user,  load average: 0.00, 0.01, 0.05</div><div class="line">USER     TTY      <span class="keyword">FROM</span>             LOGIN@   IDLE   JCPU   PCPU WHAT</div><div class="line">root     pts/0    192.168.1.105    15:25    6.00s  0.06s  0.01s w</div></pre></td></tr></table></figure></p>
<p>关于w命令的说明：</p>
<ul>
<li>第一行从左到右一次显示的信息是：时间-系统运行时间-登陆用户数-平均负载</li>
<li>从第二行开始的所有行则是：当前登陆的用户名，其登陆终端（tty表示本地终端，pts\0表示远程终端），IP地址、登陆时间、WHAT所使用的命令。</li>
<li>在这些信息中，最应该关注的就是第一行中的load average：后面的三个数值了</li>
</ul>
<p>关于load average的说明：</p>
<ul>
<li>第一个数值表示一分钟内系统的平均负载值，第二个数值表示五分钟内系统的平均负载值，第三个数值表示十五分钟内系统的平均负载值。</li>
<li>我们着重看第一个值，它表示单位时间内使用CPU的活动进程数（在这里其实就是指一分钟内），该值越大说明服务器压力越大。一般情况下，这个值只要不超过服务器的CPU数量就没有关系。（如果服务器的CPU数量为8，那么值小于8就说明当前服务器没有压力，否则就需要关注一下了）</li>
</ul>
<p>查看服务器有几个CPU的方法如下：</p>
<ul>
<li><code>cat /proc/cpuinfo</code> 查看/proc/cpuinfo这个文件的内容，该文件记录了CPU的详细信息。</li>
<li>目前市面上的服务器有很多是2颗多核CPU，在Linux看来，它就是2*n个CPU（这里的n为单颗物理CPU上有几核）。</li>
<li>假如n是4，则查看这个文件时会显示8段类似的信息，而最后一段信息的processor：后面会显示7。</li>
<li>所以查看当前系统有几个CPU，可以用这个命令：<code>grep -c &#39;processor&#39; /proc/cpuinfo</code>。</li>
<li>然而查看有几颗物理CPU时，则需要查看关键字”physical id”：<code>grep -c &#39;physical&#39; /proc/cpuinfo</code>。</li>
</ul>
<p>补充内容：</p>
<ul>
<li><code>ab -n 10000 -c 100 网址</code> 用来对网站进行压力测试：访问10000次，并发量100.。</li>
<li><code>uptime</code> 显示w命令的第一行内容</li>
</ul>
<h2 id="1-2-vmstat-监控系统状态"><a href="#1-2-vmstat-监控系统状态" class="headerlink" title="1.2. vmstat 监控系统状态"></a>1.2. vmstat 监控系统状态</h2><p>命令w查看的是系统整体上的负载，通过查看那个数值就可以知道当前系统有没有压力，但它无法判断究竟具体是哪里（CPU、内存、磁盘等）有压力。所以这就用到了vmstat这个命令。其具体用法如下：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># vmstat</div><div class="line">procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----</div><div class="line"> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st</div><div class="line"> <span class="number">1</span>  <span class="number">0</span>      <span class="number">0</span> <span class="number">522200</span>   <span class="number">2076</span> <span class="number">349976</span>    <span class="number">0</span>    <span class="number">0</span>    <span class="number">30</span>    <span class="number">34</span>   <span class="number">51</span>   <span class="number">47</span>  <span class="number">0</span>  <span class="number">0</span> <span class="number">99</span>  <span class="number">0</span>  <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>vmstat命令打印的结果共分为6个部分：procs、memory、swap、io、system、cpu。请重点关注一下r、b、si、so、bi、bo这几列信息。</p>
<p>说明：</p>
<ul>
<li>procs显示进程的相关信息<ul>
<li>r（run）：表示运行或等待CPU时间片的进程数。不要误认为等待CPU时间片意味着这个进程没有运行，实际上某一时刻1个CPU只能有一个进程占用，其他进程只能排着队等着，此时这些排队等待CPU资源的进程依然是运行状态。该数值如果长期大于服务器CPU的个数，则说明CPU的资源不够用了。</li>
<li>b（block）：表示等待资源的进程数，这个资源指的是I/O、内存等。举个例子，当磁盘读写非常频繁时，写数据就会非常慢，此时CPU运算很快就结束了，但进程需要把计算的结果写入磁盘，这样进程的任务才算完成，那此时这个进程只能慢慢地等待磁盘了，这样这个进程就是这个状态。该数值如果长时间大于1，则需要关注一下了。</li>
</ul>
</li>
<li>memory显示内存的相关信息<ul>
<li>swap：表示切换到交换分区中的内存数量，单位kb。</li>
<li>free：表示当前空闲的内存数量，单位kb。</li>
<li>buff：表示（即将写入磁盘的）缓冲大小，单位kb。</li>
<li>cache：表示（从磁盘中读取的）缓存大小，单位kb。</li>
</ul>
</li>
<li>swap显示内存的交换情况<ul>
<li>si：表示由交换区写入内存的数据量，单位kb。</li>
<li>so：表示由内存写入交换区的数据量，单位kb。</li>
</ul>
</li>
<li>io显示磁盘的使用情况<ul>
<li>bi：表示从块设备读取数据的量（读磁盘），单位kb。</li>
<li>bo：表示从块设备写入数据的量（写磁盘），单位kb。</li>
</ul>
</li>
<li>system显示采集间隔内发生的中断次数<ul>
<li>in：表示再某一段时间间隔内观测到的每秒设备的中断次数。</li>
<li>cs：表示每秒产生的上下文切换次数。</li>
</ul>
</li>
<li>cpu显示CPU的使用状态<ul>
<li>us：显示用户下所花费CPU的时间百分比。</li>
<li>sy：显示系统花费CPU的时间百分比。</li>
<li>id：表示CPU处于空闲状态的时间百分比。</li>
<li>wa：表示I/O等待所占用CPU的时间百分比。</li>
<li>st：表示被偷走的CPU所占百分比（一般都为0，不用关注）</li>
</ul>
</li>
</ul>
<p>以上所介绍的各个参数中，再运维工作中经常会关注r、b、wa这三列。io部分的bi和bo也是要经常参考的对象，如果磁盘io压力大，这两列的数值就会比较高。另外，当si和so两列的数值比较高并且不断变化时，说明内存不够了，内存中的数据会频繁交换到交换分区中，这往往对系统性能影响极大。</p>
<p>我们使用vmstat查看系统状态时，通常都是使用如下形式：</p>
<ul>
<li><code>vmstat 1 5</code> 表示每隔1秒输出一次状态，共输出5次。</li>
<li><code>cmstat 1</code>  表示每隔1秒输出一次状态且一直输出，知道按下Ctrl+C结束。</li>
</ul>
<h2 id="1-3-top-显示进程所占用的系统资源"><a href="#1-3-top-显示进程所占用的系统资源" class="headerlink" title="1.3. top 显示进程所占用的系统资源"></a>1.3. top 显示进程所占用的系统资源</h2><p>具体用法如下：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">top - 17:37:05 up  2:25, <span class="number"> 1 </span>user,  load average: 0.00, 0.01, 0.05</div><div class="line">Tasks: <span class="number"> 91 </span>total,  <span class="number"> 1 </span>running, <span class="number"> 90 </span>sleeping,  <span class="number"> 0 </span>stopped,  <span class="number"> 0 </span>zombie</div><div class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</div><div class="line">KiB Mem : <span class="number"> 1008176 </span>total,  <span class="number"> 507628 </span>free,  <span class="number"> 135092 </span>used,  <span class="number"> 365456 </span>buff/cache</div><div class="line">KiB Swap: <span class="number"> 4194300 </span>total, <span class="number"> 4194300 </span>free,       <span class="number"> 0 </span>used.  <span class="number"> 684136 </span>avail Mem</div><div class="line"></div><div class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</div><div class="line">   <span class="number"> 1 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span><span class="number"> 128164 </span> <span class="number"> 6848 </span> <span class="number"> 4076 </span>S   0.0  0.7   0:01.38 systemd</div><div class="line">   <span class="number"> 2 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.02 kthreadd</div><div class="line">   <span class="number"> 3 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:02.17 ksoftirqd/0</div><div class="line">   <span class="number"> 5 </span>root      <span class="number"> 0 </span>-20      <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.00 kworker/0:0H</div><div class="line">   <span class="number"> 7 </span>root      rt  <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.10 migration/0</div><div class="line">   <span class="number"> 8 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.00 rcu_bh</div><div class="line">   <span class="number"> 9 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:01.30 rcu_sched</div><div class="line">  <span class="number"> 10 </span>root      rt  <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.15 watchdog/0</div><div class="line">  <span class="number"> 11 </span>root      rt  <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.18 watchdog/1</div><div class="line">  <span class="number"> 12 </span>root      rt  <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.06 migration/1</div><div class="line">  <span class="number"> 13 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.15 ksoftirqd/1</div><div class="line">  <span class="number"> 15 </span>root      <span class="number"> 0 </span>-20      <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.00 kworker/1:0H</div><div class="line">  <span class="number"> 17 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.00 kdevtmpfs</div></pre></td></tr></table></figure></p>
<p>top命令用于动态监控进程所占的系统资源，每隔3秒变一次。它的特点是把占用系统资源（CPU、内存、磁盘I/O等）最高的进程放到最前面。</p>
<p>如例所示，top命令打印出很多信息，包括系统负载（load average）、进程数（Tasks）、CPU使用情况、内存使用情况以及交换分区使用情况。这些内容其实可以通过其它命令来查看，用top的重点查看的还是下面的进程使用系统资源的详细状况，其中需要关注的是%CPU、%MEM和COMMAND这几项所代表的意义。RES这一项为进程所占用的内存大小，而%MEM这一项为使用内存的百分比。在top状态下，默认按CPU的使用百分比情况排序，按Shift+M可以按照内存使用大小来排序。按数字1可以列出所有核CPU的使用状态，按q可以推出top。</p>
<p>top的内容说明：</p>
<ul>
<li>第一行（综述）：同w命令的第一行（或uptime命令）所示的一样，只不过是动态的（默认3s刷新一次状态）</li>
<li>第二行（进程）：进程总数、正在运行进程数、休眠进程数、被停止进程数、僵尸进程数</li>
<li>第三行（CPU）：us用户态进程、sy内核态进程、ni、id、wa等待（I/O）、hi、si、st</li>
<li>第四行（内存）：总大小、已使用的、空闲的、缓冲量大小</li>
<li>第五行（Swap）：总大小、已使用的、空闲的、缓存量大小<ul>
<li>缓冲和缓存的区别：</li>
<li>缓冲（buffer）：是为了提高内存和硬盘（或其他I/O设备）之间的数据交换的速度而设计的（内存–硬盘）</li>
<li>缓存（cache）：是为了提高CPU和内存之间的数据交换速度而设计的（内存–CPU）</li>
</ul>
</li>
<li>第六行：PID进程号、USER进程使用者、PR优先级、NI优先值（从-20到19,数值越低，优先级越高）、VIRT虚拟内存大小、RES真正内存使用大小、SHR共享内存大小、S表示状态、%CPU、%MEM、TIME+时间、COMMAND命令</li>
</ul>
<p>在日常工作中常用到命令 <code>top -bn1</code>，它表示非动态打印系统资源的使用情况，和top命令的唯一区别就是，它一次性输出所有信息而非动态显示。这条命令可以用在shell脚本中。示例如下：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">]<span class="comment"># top -bn1 | head</span></div><div class="line">top - 17:42:27 up  2:31, <span class="number"> 1 </span>user,  load average: 0.00, 0.01, 0.05</div><div class="line">Tasks: <span class="number"> 92 </span>total,  <span class="number"> 1 </span>running, <span class="number"> 91 </span>sleeping,  <span class="number"> 0 </span>stopped,  <span class="number"> 0 </span>zombie</div><div class="line">%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st</div><div class="line">KiB Mem : <span class="number"> 1008176 </span>total,  <span class="number"> 508100 </span>free,  <span class="number"> 134564 </span>used,  <span class="number"> 365512 </span>buff/cache</div><div class="line">KiB Swap: <span class="number"> 4194300 </span>total, <span class="number"> 4194300 </span>free,       <span class="number"> 0 </span>used.  <span class="number"> 684652 </span>avail Mem</div><div class="line"></div><div class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND</div><div class="line">   <span class="number"> 1 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span><span class="number"> 128164 </span> <span class="number"> 6848 </span> <span class="number"> 4076 </span>S   0.0  0.7   0:01.38 systemd</div><div class="line">   <span class="number"> 2 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:00.02 kthreadd</div><div class="line">   <span class="number"> 3 </span>root     <span class="number"> 20 </span> <span class="number"> 0 </span>     <span class="number"> 0 </span>    <span class="number"> 0 </span>    <span class="number"> 0 </span>S   0.0  0.0   0:02.17 ksoftirqd/0</div></pre></td></tr></table></figure></p>
<p><code>top -c</code> 这个命令是使 COMMAND那一列显示的更全一些。</p>
<h2 id="1-4-sar-监控系统状态"><a href="#1-4-sar-监控系统状态" class="headerlink" title="1.4. sar 监控系统状态"></a>1.4. sar 监控系统状态</h2><p>sar命令很强大，它可以监控系统几乎所有资源的状态，比如平均负载、网卡流量、磁盘状态、内存使用等。与其它系统状态监控工具不同，它可以打印历史信息，可以显示当天从零点开始到当前时刻的系统状态信息。如果你的系统没有安装这个命令，请使用<code>yum install -y sysstat</code>安装。</p>
<p>初次使用sar命令会报错，这是因为sar工具还没有生成相应的数据库文件（无需实时监控，因为不用去查询那个库文件）。它的数据库文件再/var/log/sa/目录下。因为这个命令太复杂，下面仅仅介绍最常用的两个方面的用法。</p>
<h3 id="用法1-查看网卡流量-sar-n-DEV"><a href="#用法1-查看网卡流量-sar-n-DEV" class="headerlink" title="用法1. 查看网卡流量 sar -n DEV"></a>用法1. 查看网卡流量 <code>sar -n DEV</code></h3><p>具体用法如下：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># sar -n DEV</div><div class="line">Linux <span class="number">2.6</span><span class="number">.32</span><span class="number">-358.</span>el6.i686 (localhost.localdomain) <span class="number">2013</span>年<span class="number">05</span>月<span class="number">25</span>日 _i686_ (<span class="number">1</span> CPU)</div><div class="line"></div><div class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒   IFACE    rxpck/s    txpck/s     rxKB/s    txKB/s    rxcmp/s    txcmp/s    rxmcst/s</div><div class="line"><span class="number">00</span>时<span class="number">10</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">10</span>分<span class="number">01</span>秒    eth0    <span class="number">31.94</span>       <span class="number">0.09</span>        <span class="number">3.89</span>       <span class="number">0.02</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span>   </div><div class="line"><span class="number">00</span>时<span class="number">20</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">20</span>分<span class="number">01</span>秒    eth0    <span class="number">32.40</span>       <span class="number">0.04</span>        <span class="number">3.96</span>       <span class="number">0.01</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">30</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">30</span>分<span class="number">01</span>秒    eth0    <span class="number">31.18</span>       <span class="number">0.09</span>        <span class="number">3.76</span>       <span class="number">0.02</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div></pre></td></tr></table></figure></p>
<p>说明：</p>
<ul>
<li>在上面所示的例子里并没有把全部信息贴出来，因为太多了。</li>
<li>IFACE这列表示设备名称。</li>
<li>rxpck/s表示每秒进入收取的包的数量（单位Byte）。</li>
<li>txbyt/s表示每秒发送的数据量。</li>
<li>后面几列不需要关注。</li>
<li>如果有一天您所管理的服务器丢包非常严重,那么您就应该看一看这个网卡流量是否异常了,如果rxpck/s 那一列的数值大于4000,或者rxbyt/s那列大于5,000,000，则很有可能是被攻击了,正常的服务器网卡流量不会高于这么多,除非是您自己在拷贝数据。</li>
</ul>
<p>上面的命令是查看网卡流量历史的，如何实时查看网卡流量呢？用下面的命令：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">$ sar -n DEV <span class="number">1</span> <span class="number">5</span></div><div class="line">Linux <span class="number">4.4</span><span class="number">.0</span><span class="number">-53</span>-generic (theshu-Latitude-D530) 	<span class="number">2017</span>年<span class="number">10</span>月<span class="number">06</span>日 	_i686_	(<span class="number">2</span> CPU)</div><div class="line"></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">05</span>秒     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">06</span>秒   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">06</span>秒        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">06</span>秒    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">06</span>秒     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">07</span>秒   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">07</span>秒        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">07</span>秒    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">07</span>秒     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">08</span>秒   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">08</span>秒        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">08</span>秒    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line">c</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">08</span>秒     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">09</span>秒   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">09</span>秒        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">09</span>秒    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">09</span>秒     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">10</span>秒   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">10</span>秒        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">33</span>分<span class="number">10</span>秒    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line"></div><div class="line">平均时间:     IFACE   rxpck<span class="regexp">/s   txpck/</span>s    rxkB<span class="regexp">/s    txkB/</span>s   rxcmp<span class="regexp">/s   txcmp/</span>s  rxmcst/s   %ifutil</div><div class="line">平均时间:   wlp12s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line">平均时间:        lo      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div><div class="line">平均时间:    enp9s0      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span>      <span class="number">0.00</span></div></pre></td></tr></table></figure></p>
<p>上面的命令是很常用的，用来查看网卡流量，一秒钟显示1次，共显示5次。着重查看rxpck/s（数据包量）和rxbyt/s（数据量）</p>
<p>另外也可以查看某一天的网卡流量历史，使用-f选项，后面跟文件名，如果你的系统为CentOS或者是RedHat，那么sar的库文件一定是在/var/log/sa/目录下的：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"># sar -n DEV -f /var/log/sa/sa24</div><div class="line">Linux <span class="number">2.6</span><span class="number">.32</span><span class="number">-358.</span>el6.i686 (localhost.localdomain) <span class="number">2013</span>年<span class="number">05</span>月<span class="number">25</span>日 _i686_ (<span class="number">1</span> CPU)</div><div class="line"></div><div class="line"><span class="number">10</span>时<span class="number">49</span>分<span class="number">36</span>秒	LINUX  RESTART</div><div class="line"></div><div class="line"><span class="number">11</span>时<span class="number">00</span>分<span class="number">01</span>秒   IFACE    rxpck/s    txpck/s     rxKB/s    txKB/s    rxcmp/s    txcmp/s    rxmcst/s</div><div class="line"><span class="number">11</span>时<span class="number">10</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">20</span>分<span class="number">01</span>秒    eth0    <span class="number">31.94</span>       <span class="number">0.09</span>        <span class="number">3.89</span>       <span class="number">0.02</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">30</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">40</span>分<span class="number">01</span>秒    eth0    <span class="number">32.40</span>       <span class="number">0.04</span>        <span class="number">3.96</span>       <span class="number">0.01</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">50</span>分<span class="number">01</span>秒      lo     <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span>       <span class="number">0.00</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">11</span>时<span class="number">60</span>分<span class="number">01</span>秒    eth0    <span class="number">31.18</span>       <span class="number">0.09</span>        <span class="number">3.76</span>       <span class="number">0.02</span>    <span class="number">0.00</span>        <span class="number">0.00</span>        <span class="number">0.00</span></div></pre></td></tr></table></figure></p>
<p><code>ls /var/log/sa/</code> 你会看到两种不同的文件，一个是以sa开头加日期，一个是sar开头加日期，其中sa加日期的文件是不能直接用cat查看的，只能使用<code>sar -f</code>来查看，另外一种sar加日期的文件是可以直接用cat等工具查看的。他们都是记录系统状态历史信息。</p>
<h3 id="用法2-查看历史负载"><a href="#用法2-查看历史负载" class="headerlink" title="用法2. 查看历史负载"></a>用法2. 查看历史负载</h3><p>示例如下：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># sar -q</div><div class="line">Linux <span class="number">2.6</span><span class="number">.32</span><span class="number">-358.</span>el6.i686(localhost.localdomain)	<span class="number">2013</span>年<span class="number">05</span>月<span class="number">25</span>日  _i686_(<span class="number">1</span> CPU)</div><div class="line"></div><div class="line"><span class="number">00</span>时<span class="number">00</span>分<span class="number">01</span>秒   runq-sz    plist-sz    ldavg<span class="number">-1</span>    ldavg<span class="number">-5</span>    ldavg<span class="number">-15</span></div><div class="line"><span class="number">00</span>时<span class="number">10</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">142</span>       <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">20</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">30</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.00</span>       <span class="number">0.01</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">40</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.05</span>       <span class="number">0.01</span>        <span class="number">0.00</span></div><div class="line"><span class="number">00</span>时<span class="number">50</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">01</span>时<span class="number">00</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.00</span>       <span class="number">0.00</span>        <span class="number">0.00</span></div><div class="line"><span class="number">01</span>时<span class="number">10</span>分<span class="number">01</span>秒        <span class="number">0</span>          <span class="number">143</span>       <span class="number">0.08</span>       <span class="number">0.03</span>        <span class="number">0.00</span></div></pre></td></tr></table></figure></p>
<p>说明：</p>
<ul>
<li>要使用这个命令，前提是要开启服务/etc/init.d/sysstat服务。</li>
<li>可以指定历史文件：<code>sar -q -f /var/log/sa/sa10</code></li>
<li>这个命令有助于我们查看服务器在过去的某个时间的负载状况。</li>
<li>补充一个sar的用法：<code>sar -b</code> 用来查看磁盘的读写。</li>
</ul>
<p>关于sar初学着掌握以上这两个用法即可。如果以后工作中用到，就man一下吧。</p>
<h2 id="1-5-nload-查看网卡流量"><a href="#1-5-nload-查看网卡流量" class="headerlink" title="1.5. nload 查看网卡流量"></a>1.5. nload 查看网卡流量</h2><h2 id="1-6-free-查看内存使用状况"><a href="#1-6-free-查看内存使用状况" class="headerlink" title="1.6. free 查看内存使用状况"></a>1.6. free 查看内存使用状况</h2><p>示例如下：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># free</span></div><div class="line">              total        used        free      shared  buff/cache   available</div><div class="line">Mem:       <span class="number"> 2052900 </span>    <span class="number"> 366112 </span>    <span class="number"> 605324 </span>    <span class="number"> 209940 </span>   <span class="number"> 1081464 </span>    1245724</div><div class="line">Swap:      <span class="number"> 2085884 </span>         <span class="number"> 0 </span>    2085884</div></pre></td></tr></table></figure></p>
<p>只需要敲一个free然后回车就可以知道当前系统的总内存大小以及使用内存的情况。另外我们还可以加-m或者-g选项分别以M或G为单位打印内存使用状况。如下所示：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># free -m</span></div><div class="line">              total        used        free      shared  buff/cache   available</div><div class="line">Mem:          <span class="number"> 2004 </span>       <span class="number"> 351 </span>       <span class="number"> 596 </span>       <span class="number"> 205 </span>      <span class="number"> 1057 </span>       1222</div><div class="line">Swap:         <span class="number"> 2036 </span>         <span class="number"> 0 </span>       2036</div><div class="line"><span class="comment"># free -g</span></div><div class="line">              total        used        free      shared  buff/cache   available</div><div class="line">Mem:             <span class="number"> 1 </span>         <span class="number"> 0 </span>         <span class="number"> 0 </span>         <span class="number"> 0 </span>         <span class="number"> 0 </span>          0</div><div class="line">Swap:            <span class="number"> 1 </span>         <span class="number"> 0 </span>          1</div></pre></td></tr></table></figure></p>
<h2 id="1-7-ps-查看系统进程"><a href="#1-7-ps-查看系统进程" class="headerlink" title="1.7. ps 查看系统进程"></a>1.7. ps 查看系统进程</h2><p>作为系统管理员，一定要知道您所管理的系统都有哪些进程在运行，除了上面所介绍的top可以简单查看之外，还有一个专门显示系统进程的命令，就是ps命令。示例如下：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ps aux</span></div><div class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</div><div class="line">root        <span class="number"> 1 </span> 0.0  0.2 <span class="number"> 24324 </span><span class="number"> 5444 </span>?        Ss   09:02   0:07 /sbin/init spla</div><div class="line">root        <span class="number"> 2 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [kthreadd]</div><div class="line">root        <span class="number"> 3 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [ksoftirqd/0]</div><div class="line">root        <span class="number"> 5 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   09:02   0:00 [kworker/0:0H]</div><div class="line">root        <span class="number"> 7 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:11 [rcu_sched]</div><div class="line">root        <span class="number"> 8 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [rcu_bh]</div><div class="line">root        <span class="number"> 9 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [migration/0]</div><div class="line">root       <span class="number"> 10 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [watchdog/0]</div><div class="line">root       <span class="number"> 11 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [watchdog/1]</div><div class="line">root       <span class="number"> 12 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [migration/1]</div><div class="line">root       <span class="number"> 13 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [ksoftirqd/1]</div><div class="line">root       <span class="number"> 15 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   09:02   0:00 [kworker/1:0H]</div><div class="line">root       <span class="number"> 16 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S    09:02   0:00 [kdevtmpfs]</div><div class="line">root       <span class="number"> 17 </span> 0.0  0.0     <span class="number"> 0 </span>   <span class="number"> 0 </span>?        S&lt;   09:02   0:00 [netns]</div></pre></td></tr></table></figure></p>
<p>ps命令内容说明：</p>
<ul>
<li>USER、PID、%CPU、%MEM、VSZ虚拟内存使用大小、RSS内存的使用量、TTY、STAT状态、TIME进程运行时间、COMMAAND命令</li>
<li>关于STAT状态的说明<ul>
<li>S：休眠sleep</li>
<li>s：父进程（主进程）</li>
<li>&lt;：高优先级</li>
<li>N：低优先级</li>
<li>+：前台</li>
<li>R：正在运行的</li>
<li>l（小写的L）：多线程</li>
<li>L：lock锁</li>
<li>X：已经死掉的进程</li>
<li>Z：僵尸进程（即不能杀死的进程，只能通过重启才能去掉）</li>
<li>T：被暂停的</li>
<li>D：不能中断的</li>
<li>W：这个好像是说，从内核2.6xx以后，表示为没有足够的内存页分配</li>
</ul>
</li>
</ul>
<p>另外一个类似与<code>ps aux</code>的使用方式为<code>ps -elf</code>，两者的功能差不多。其选项说明如下:</p>
<ul>
<li>-l：把当前终端下运行的程序列出来</li>
<li>-e：把后台所有的程序都列出来</li>
<li>-f：显示Stime<br>示例如下：<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># ps -elf</span></div><div class="line">F S UID        PID  PPID  C PRI  NI ADDR SZ WCHAN  STIME TTY          TIME CMD</div><div class="line">4 S root        <span class="number"> 1 </span>   <span class="number"> 0 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>- <span class="number"> 6327 </span>-      09:41 ?        00:00:07 /sbin</div><div class="line">1 S root        <span class="number"> 2 </span>   <span class="number"> 0 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>-    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [kthr</div><div class="line">1 S root        <span class="number"> 3 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>-    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [ksof</div><div class="line">1 S root        <span class="number"> 5 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 60 </span>-20 -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [kwor</div><div class="line">1 S root        <span class="number"> 7 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>-    <span class="number"> 0 </span>-      09:41 ?        00:00:08 [rcu_</div><div class="line">1 S root        <span class="number"> 8 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>-    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [rcu_</div><div class="line">1 S root        <span class="number"> 9 </span>   <span class="number"> 2 </span><span class="number"> 0 </span>-40   - -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [migr</div><div class="line">5 S root       <span class="number"> 10 </span>   <span class="number"> 2 </span><span class="number"> 0 </span>-40   - -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [watc</div><div class="line">5 S root       <span class="number"> 11 </span>   <span class="number"> 2 </span><span class="number"> 0 </span>-40   - -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [watc</div><div class="line">1 S root       <span class="number"> 12 </span>   <span class="number"> 2 </span><span class="number"> 0 </span>-40   - -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [migr</div><div class="line">1 S root       <span class="number"> 13 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 80 </span> <span class="number"> 0 </span>-    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [ksof</div><div class="line">1 S root       <span class="number"> 15 </span>   <span class="number"> 2 </span><span class="number"> 0 </span><span class="number"> 60 </span>-20 -    <span class="number"> 0 </span>-      09:41 ?        00:00:00 [kwor</div><div class="line">.......</div></pre></td></tr></table></figure>
</li>
</ul>
<p>关于ps命令，以上两个用法就足够了。在工作中，经常把ps命令和管道父结合使用，用来查看某个进程或者它的数量，如下所示：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># <span class="keyword">ps</span> aux | <span class="keyword">grep</span> -<span class="keyword">c</span> mingetty</div><div class="line"><span class="number">1</span></div><div class="line"># <span class="keyword">ps</span> aux | <span class="keyword">grep</span> mingetty</div><div class="line">theshu    <span class="number">4454</span>  <span class="number">0.0</span>  <span class="number">0.0</span>   <span class="number">6864</span>   <span class="number">812</span> <span class="keyword">pts</span>/<span class="number">1</span>    S+   <span class="number">12</span>:<span class="number">16</span>   <span class="number">0</span>:<span class="number">00</span> <span class="keyword">grep</span> --color=auto mingetty</div></pre></td></tr></table></figure></p>
<p><code>pstree</code> 命令的功能是以树状的显示出进程之间的关系和情况。</p>
<h2 id="1-8-netstat-查看网络状况"><a href="#1-8-netstat-查看网络状况" class="headerlink" title="1.8. netstat 查看网络状况"></a>1.8. netstat 查看网络状况</h2><p>netstat命令用来打印网络连接状况、系统所开放的端口、路由表等信息。关于这个命令最常用的两种方式就是<code>netstat -lnp</code>（打印当前系统启动哪些端口）和<code>netstat -an</code>（打印网络连接状况），请一定要记住。示例如下：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># netstat -lnp</span></div><div class="line">（并非所有进程都能被检测到，所有非本用户的进程信息将不会显示，如果想看到所有信息，则必须切换到 root 用户）</div><div class="line">激活Internet连接 (仅服务器)</div><div class="line">	Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name</div><div class="line">	tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:3689            0.0.0.0:*               LISTEN      4186/rhythmbox  </div><div class="line">	tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.1.1:53            0.0.0.0:*               LISTEN      -               </div><div class="line">	tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::3689                 :::*                    LISTEN      4186/rhythmbox  </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.1.1:53            0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:68              0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:37475           0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:631             0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>192.168.43.247:123      0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.0.1:123           0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:123             0.0.0.0:*                           -               </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:5353            0.0.0.0:*                           -               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::50784                :::*                                -               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>fe80::3e92:1783:1f3:123 :::*                                -               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>::1:123                 :::*                                -               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::123                  :::*                                -               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::5353                 :::*                                -               </div><div class="line">	raw6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::58                   :::*                   <span class="number"> 7 </span>          -               </div><div class="line">	活跃的UNIX域套接字 (仅服务器)</div><div class="line">	Proto RefCnt Flags       Type       State         I-Node   PID/Program name    路径</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     流        LISTENING    <span class="number"> 23756 </span>   1632/systemd        /run/user/1000/systemd/private</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     SEQPACKET  LISTENING    <span class="number"> 1896 </span>    -                   /run/udev/control</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     流        LISTENING    <span class="number"> 22839 </span>   -                   /run/user/1000/keyring/control</div><div class="line">.......</div><div class="line"></div><div class="line"><span class="comment"># netstat -an</span></div><div class="line">激活Internet连接 (服务器和已建立连接的)</div><div class="line">	Proto Recv-Q Send-Q Local Address           Foreign Address         State      </div><div class="line">	tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:3689            0.0.0.0:*               LISTEN     </div><div class="line">	tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.1.1:53            0.0.0.0:*               LISTEN     </div><div class="line">	tcp       <span class="number"> 0 </span>    <span class="number"> 0 </span>192.168.43.247:46792    123.58.182.252:80       ESTABLISHED</div><div class="line">	tcp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::3689                 :::*                    LISTEN     </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.1.1:53            0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:68              0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:37475           0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:631             0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>192.168.43.247:123      0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>127.0.0.1:123           0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:123             0.0.0.0:*                          </div><div class="line">	udp       <span class="number"> 0 </span>    <span class="number"> 0 </span>0.0.0.0:5353            0.0.0.0:*                          </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::50784                :::*                               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>fe80::3e92:1783:1f3:123 :::*                               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>::1:123                 :::*                               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::123                  :::*                               </div><div class="line">	udp6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::5353                 :::*                               </div><div class="line">	raw6      <span class="number"> 0 </span>    <span class="number"> 0 </span>:::58                   :::*                   <span class="number"> 7 </span>         </div><div class="line">	活跃的UNIX域套接字 (服务器和已建立连接的)</div><div class="line">	Proto RefCnt Flags       Type       State         I-Node   路径</div><div class="line">	unix <span class="number"> 2 </span>     [ ]         数据报               <span class="number"> 23755 </span>   /run/user/1000/systemd/notify</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     流        LISTENING    <span class="number"> 23756 </span>   /run/user/1000/systemd/private</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     SEQPACKET  LISTENING    <span class="number"> 1896 </span>    /run/udev/control</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     流        LISTENING    <span class="number"> 22839 </span>   /run/user/1000/keyring/control</div><div class="line">	unix <span class="number"> 2 </span>     [ ACC ]     流        LISTENING    <span class="number"> 24162 </span>   /run/user/1000/keyring/ssh</div><div class="line">	......</div></pre></td></tr></table></figure></p>
<p>关于<code>netstat -an</code>命令内容中连接状态的说明：</p>
<ul>
<li>TIME_WAIT 等待</li>
<li>ESTALISHED 已连接</li>
<li>LISHEN 监听</li>
<li><code>netstat -an | wc -l</code> 可简单查看一下机器的并发量</li>
<li>如果你所管理的服务器是一台提供Web服务（80端口）的服务器，那么就可以使用<code>netstat -an | grep 80</code>来查看当前连接Web服务的有哪些IP了</li>
</ul>
<hr>
<h1 id="2-抓包工具"><a href="#2-抓包工具" class="headerlink" title="2. 抓包工具"></a>2. 抓包工具</h1><h2 id="2-1-tcpdump工具"><a href="#2-1-tcpdump工具" class="headerlink" title="2.1. tcpdump工具"></a>2.1. tcpdump工具</h2><p>如果没有这个命令，需要用<code>yum install -y tcpdump</code>命令去安装一下。下面是关于这个命令的两个常用的方式：</p>
<ol>
<li><code>tcpdump -nn -i eth0</code><ul>
<li>-i选项后面跟设备名称，如果想抓eth1网卡的包，后面则要跟eth1。至于-nn选项的作用则是让第三列和第四列显示成”IP+端口号”的形式，如果不加-nn则显示的是”主机名+服务名称”。</li>
<li>这里需要关注的只是第三列和第四列，显示的信息为哪一个IP+Port在连接哪一个IP+Port。</li>
</ul>
</li>
<li><code>tcpdump -nn -i eth0 host 192.168;.1.100 and port 80 -c 100 -w 1.cap</code><ul>
<li>可以用host指定ip，用port指定端口，-c指定包数量，-w写入指定文件里。这样1.cap文件里面是包的内容，而如果不加-w则直接在屏幕上显示的不是数据包，而是数据流向。这个1.cap可以下载到Windows系统上，然后使用wireshark查看。</li>
<li>-s0选项是抓取全部包</li>
<li>如果在网卡名后面加上tcp，则只会抓取tcp的包</li>
<li>and表示并且，not表示取反</li>
</ul>
</li>
</ol>
<h2 id="2-2-wireshark工具"><a href="#2-2-wireshark工具" class="headerlink" title="2.2. wireshark工具"></a>2.2. wireshark工具</h2><p>默认CentOS是没有这个命令的，请使用这个命令来安装它<code>yum install -y wireshark</code>。关于这个工具只需要掌握一个用法即可，如下所示：</p>
<p><code>tshark -n -t a -R http.request -T fields -e &quot;frame.time&quot; -e &quot;ip.src&quot; -e &quot;http.host&quot; -e &quot;http.request.uri&quot;</code></p>
<p>说明：</p>
<ul>
<li>这条命令用于Web服务器，可以显示诸如下面的信息： Mar 21,2014 15:37:08.857507000 199.30.20.38 k168.123.com GET /thread-4861-1-1.html 。</li>
<li>这类似于Web访问日志，有时候若是服务器没有配置访问日志，可以临时使用该命令查看一下当前服务器上的web请求。</li>
</ul>
<hr>
<h1 id="3-Linux网络相关"><a href="#3-Linux网络相关" class="headerlink" title="3. Linux网络相关"></a>3. Linux网络相关</h1><h2 id="3-1-ifconfig-查看网卡IP"><a href="#3-1-ifconfig-查看网卡IP" class="headerlink" title="3.1. ifconfig 查看网卡IP"></a>3.1. ifconfig 查看网卡IP</h2><p>ifconfig不加任何参数，只打印当前网卡的IP相关信息（子网掩码、网关等），在之前的博客中已经记录了关于这个命令的使用。在shell下设置IP，需要修改相关的配置文件,/etc/sysconfig/network-scripts/ifcfg-eth0，如果是eth1网卡，则是/etc/sysconfig/network-scripts/ifcfg-eth1，若是ens33网卡，则是/etc/sysconfig/network-scripts/ifcfg-ens33。</p>
<p>如果Linux上有多个网卡，而只想重启某一个网卡的话，可以使用这个命令：<br><code>ifdown eth0 ; ifup eth0</code><br>ifdown 即停掉网卡，ifup即启动网卡。有一点需要注意，如果我们远程登陆服务器，当使用<code>ifdown eth0</code>这个命令的时候，很有可能后面的命令<code>ifup eth0</code>不会被运行，这样导致我们断网而无法连接服务器，所有请尽量使用<code>service network restart</code>这个命令来重启网卡。</p>
<h2 id="3-2-给一个网卡设定多个IP"><a href="#3-2-给一个网卡设定多个IP" class="headerlink" title="3.2. 给一个网卡设定多个IP"></a>3.2. 给一个网卡设定多个IP</h2><p>在Linux系统中，网卡是可以设定多重IP的。其方法如下：</p>
<ul>
<li><code>cd /etc/sysconfig/network-scripts/</code></li>
<li><code>cp ifcfg-eth0 ifcfg-eth0\:1</code></li>
<li><p>然后编辑ifcfg-eth0:1这个配置文件，内容如下，一定要注意DEVICE这里要写成”eth0:1”</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat ifcfg-eth0\:1</span></div><div class="line"><span class="attr">DEVICE</span>=eth0:<span class="number">1</span></div><div class="line"><span class="attr">HWADDR</span>=<span class="number">00</span>:<span class="number">0</span>C:<span class="number">29</span>:D9:F0:<span class="number">52</span></div><div class="line"><span class="attr">TYPE</span>=Ethernet</div><div class="line"><span class="attr">UUID</span>=a5442526-<span class="number">0329</span>-<span class="number">421</span>d-<span class="number">86</span>cf-<span class="number">8</span>d7f16d01374</div><div class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">BOOTPROTO</span>=none</div><div class="line"><span class="attr">IPADDR</span>=<span class="number">192.168</span>.<span class="number">80.5</span></div><div class="line"><span class="attr">NETMASK</span>=<span class="number">255.255</span>.<span class="number">255.0</span></div><div class="line"><span class="attr">GATEWAY</span>=<span class="number">192.168</span>.<span class="number">80.2</span></div><div class="line"><span class="attr">NM_CONTROLLED</span>=<span class="literal">yes</span></div></pre></td></tr></table></figure>
</li>
<li><p>编辑好后，重启网卡：<code>ifdown eth0 &amp;&amp; ifup eth0</code></p>
</li>
<li>之后再查看网卡ip检查是否设置成功：<code>ifconfig</code></li>
</ul>
<h2 id="3-3-查看网卡连接状态"><a href="#3-3-查看网卡连接状态" class="headerlink" title="3.3. 查看网卡连接状态"></a>3.3. 查看网卡连接状态</h2><p>查看网卡连接状态的命令为：<code>mii-tool eth0</code></p>
<ul>
<li>在虚拟机上该命令所显示的内容是： <code>SIOCGMIIPHY on &#39;eth0&#39; failed: Operation not supported</code></li>
<li>在真机上该命令所显示的内容是：<code>eth0: nogotiated 100baseTx-FD, Link ok</code></li>
<li>只要看到”Link ok”就说明网卡为连接状态，如果显示”No link”说明网卡坏掉了或者没有连接网线。</li>
</ul>
<h2 id="3-4-更改主机名"><a href="#3-4-更改主机名" class="headerlink" title="3.4. 更改主机名"></a>3.4. 更改主机名</h2><p>当装完系统后，默认的主机名为localhost，使用<code>hostname</code>命令就可以知道您的linux主机名是什么：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> hostname</span></div><div class="line">localhost.localdomain</div></pre></td></tr></table></figure></p>
<p>同样可以使用<code>hostname</code>命令可以更改主机名（这种更改方式只是这次登陆有效，重启后还会恢复原样）：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> hostname Aming</span></div><div class="line"><span class="meta">#</span><span class="bash"> hostname</span></div><div class="line">Aming</div></pre></td></tr></table></figure></p>
<p>若是想永久更改主机名，则需要修改相关的配置文件/etc/sysconfig/network，其修改内容如下：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim /etc/sysconfig/network</span></div><div class="line"><span class="attr">NETWORKING</span>=<span class="literal">yes</span></div><div class="line"><span class="attr">HOSTNAME</span>=Aming.localdomain</div></pre></td></tr></table></figure></p>
<h2 id="3-5-设置DNS"><a href="#3-5-设置DNS" class="headerlink" title="3.5. 设置DNS"></a>3.5. 设置DNS</h2><p>DNS是用来解析域名用的，平时我们访问网站都是直接输入一个网址，而DNS把这个网址解析到一个IP。</p>
<p>在Linux下设置DNS非常简单，只要把DNS地址写到一个配置文件中即可。这个配置文件就是/etc/resolv.conf。示例如下：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vim /etc/resolv.conf</span></div><div class="line">; generated <span class="keyword">by</span> /sbin/dhclient-<span class="keyword">script</span></div><div class="line">nameserver <span class="number">202.106</span><span class="number">.46</span><span class="number">.151</span></div></pre></td></tr></table></figure></p>
<p>关于配置文件/etc/resolv.conf的说明：</p>
<ul>
<li>resolv.conf有它固有的格式，一定要写成<code>nameserver IP</code>的格式。</li>
<li>上面那行以”;”开头的是注释。</li>
<li>建议写两个或多个nameserver，默认会用第一个nameserver去解析域名，当第一个解析不到时会使用第二个，以此类推。</li>
</ul>
<p>在Linux下面有一个特殊的文件/etc/hosts也能解析域名，不过需要我们手动在这里面添加”IP+域名”这些内容，它的作用是临时解析某个域名，非常有用。示例如下：<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># vim /etc/hosts</div><div class="line"><span class="number">127.0,0,1</span> localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line"><span class="number">::1</span>		  localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line"><span class="number">192.168.1.111</span>	www.baidu.com</div></pre></td></tr></table></figure></p>
<p>保存一下，再ping一下www.baidu.com就会到192.168.1.111了。</p>
<p>关于配置文件/etc/hosts的说明：</p>
<ul>
<li>/etc/hosts 的格式很简单，没一行作为一条记录，分成两部分，第一部分是IP，第二部分是域名。</li>
<li>关于/etc/hosts文件有几点需要注意：<ul>
<li>一个IP后面可以跟多个域名，可以是几十个，甚至上百个</li>
<li>每行只能有一个IP，也就是说，一个域名不能对应多个IP</li>
<li>如果有多行中出现相同的域名（前面IP不一样），会按最前面出现的记录来解析</li>
</ul>
</li>
</ul>
<hr>
<h1 id="4-Linux的防火墙"><a href="#4-Linux的防火墙" class="headerlink" title="4. Linux的防火墙"></a>4. Linux的防火墙</h1><h2 id="4-1-SELinux介绍"><a href="#4-1-SELinux介绍" class="headerlink" title="4.1. SELinux介绍"></a>4.1. SELinux介绍</h2><p>SELinux是RedHat和CentOS系统特有的安全机制。如果能够正确使用它，会使网站非常健壮。不过因为这个东西限制太多，配置也特别繁琐，所以几乎没有人真正应用它（包括腾讯公司也不用）。所以装完系统后，我们一般都要把SELinux关闭，以免引起不必要的麻烦。</p>
<p>关闭SELinux的方法如下：</p>
<ul>
<li>临时关闭：<code>setenforce 0</code></li>
<li>永久关闭：编辑配置文件/etc/selinux/config，使”SELinux=disabled”（默认为enforcing）。保存该配置文件后，需要重启LInux系统才能生效。</li>
</ul>
<p>获取当前SELinux的状态的方法如下：</p>
<ul>
<li><code>getenforce</code></li>
<li>如果没有这个命令，需要安装这个包：libselinux-utils。</li>
<li>该命令默认会输出”enforcing”。若是已经永久关闭SELinux了，则会显示”Disabled”。</li>
<li>当使用<code>setenforce 0</code>临时关闭SELinux之后，再使用<code>getendorce</code>会输出”permissive”。</li>
</ul>
<h2 id="4-2-iptables详解"><a href="#4-2-iptables详解" class="headerlink" title="4.2. iptables详解"></a>4.2. iptables详解</h2><p>真正的防火墙名字叫做netfilter，ipdables只是它的一个实现工具。它的功能非常丰富，但是在日常的管理工作中仅仅会用到一两个应用，这并不代表它不重要。作为一个网络管理员，iptables的各种应用规则是必须要熟练掌握的。但是作为系统管理员，我们也应该会最基本的操作，认识iptables的基本规则。</p>
<h3 id="4-2-1-查看、清除和保存规则"><a href="#4-2-1-查看、清除和保存规则" class="headerlink" title="4.2.1. 查看、清除和保存规则"></a>4.2.1. 查看、清除和保存规则</h3><p>CentOS上默认是设有iptables规则的，这个规则虽然很安全，但是对于我们来说没有用，反而会造成某些影响，所以建议你先清除规则，然后把清除后的规则保存一下：</p>
<ul>
<li><code>iptables -nvL</code> 查看规则</li>
<li><code>iptables -F ; /etc/init.d/iptables save</code> 防火墙规则保存在了/etc/sysconfig/iptables中。</li>
<li>关于上面两条命令的说明：<code>-nvL</code>选项是查看规则，<code>-F</code>是把当前规则清除，但这个只是临时的，重启系统或者重启iptables服务后还会夹在已经保存的规则，所以需要使用<code>/etc/init.d/iptables save</code>保存一下规则。</li>
</ul>
<h3 id="4-2-2-iptables的几个表"><a href="#4-2-2-iptables的几个表" class="headerlink" title="4.2.2. iptables的几个表"></a>4.2.2. iptables的几个表</h3><p>filter表</p>
<ul>
<li>这个表主要用于过滤包的，是系统预设的表，这个表也是工作中用的最多的。</li>
<li>内建三个链：INPUT、OUTPUT、FORWARD。</li>
<li>INPUT作用于进入本机的包，OUTPUT作用于本机送出的包，FORWARD作用于那些跟本机无关的包。</li>
</ul>
<p>nat表</p>
<ul>
<li>主要用处是网络地址转换，比如公网IP和内网IP之间的转换。也有三个链。</li>
<li>PREROUTING链的作用是在包刚刚到达防火墙时改变它的目的地址，如果需要的话。</li>
<li>OUTPUT链改变本地产生的包的地址。</li>
<li>POSTROUTING链在包就要离开防火墙之前改变其源地址。</li>
<li>这个表在工作中用的不多，但偶尔会用到。</li>
</ul>
<p>mangle表</p>
<ul>
<li>这个表主要用于个数据打标记，然后根据标记去操作哪些包。</li>
<li>这个表几乎不怎么用。</li>
</ul>
<p>raw表</p>
<ul>
<li>对报文设置一个标志，决定数据包是否被状态跟踪机制处理。</li>
<li>只有两个链：OUTPUT、PREROUTING。</li>
<li>这个表用的不多，几乎不用。</li>
</ul>
<p>说明：</p>
<ul>
<li>INPUT 进来的-d：local本地（目标）</li>
<li>OUTPUT 出去的-s：local本地（源）</li>
</ul>
<h3 id="4-2-3-iptables的基本语法"><a href="#4-2-3-iptables的基本语法" class="headerlink" title="4.2.3. iptables的基本语法"></a>4.2.3. iptables的基本语法</h3><p>查看规则以及清除规则</p>
<ul>
<li><code>iptables -t nat -nvL</code><ul>
<li>-t后面跟表名，-nvL即查看该表的规则，其中-n表示不针对IP反解析主机名，-L表示列出的意思，而-v表示列出的信息更加详细。</li>
<li>如果不加-t，则打印filter表的相关信息：<code>iptables -nvL</code>（这和加上-t filter选项后打印的信息是一样的）</li>
</ul>
</li>
<li>关于清除规则的命令中，用的最多的就是：<ul>
<li><code>iptables -F</code> -F表示把所有规则全部删除</li>
<li><code>iptables -Z</code> -Z表示把包以及流量计数器置零（这个功能很有用）</li>
</ul>
</li>
</ul>
<p>增加或删除一条规则</p>
<ul>
<li><code>iptables -A INPUT -s 10.72.11.12 -p tcp --sport 1234 -d 10.72.137.159 --dport 80 -j DROP</code><ul>
<li>这就是增加了一条规则，省略-t所以针对的是filter表。</li>
<li>-A表示增加一条规则（放到最后），另外还有-I（大写i）表示插入一条规则（放到嘴前），-D表示删除一条规则。</li>
<li>后面的INPUT即链名称，还可以是OUTPUT或者FORWARD。</li>
<li>-s后面跟源地址。（来处）</li>
<li>-p 协议（tcp、udp、icmp）</li>
<li>–sport/–dport 后跟源端口/目标端口。（–dport/–sport必须要和-p选项一起使用，否则会出错）。</li>
<li>-d 后面跟目的IP（主要针对内网或者外网）。</li>
<li>-j 后跟动作（DROP即把包丢掉，ERJECT即包拒绝，ACCEPT即允许包）。</li>
</ul>
</li>
<li>几个例子：<ul>
<li><code>iptables -I INPUT -s 1.1.1.1 -j DROP</code>表示：插入一条规则，把来自1.1.1.1的所有数据包丢掉。</li>
<li><code>iptables -D INPUT -s 1.1.1.1 -j DROP</code>表示：删除刚刚插入的规则。注意，要删除一条规则时，必须和插入的规则一直，也就是说，两条iptables命令，除了-I和-D选项不一样之外，其他地方都一样。</li>
<li><code>iptables -I INPUT -s 2.2.2.2 -p tcp --dport 80 -j DROP</code>表示：把来自2.2.2.2并且是TCP协议到本机的80端口的数据包丢掉。</li>
<li><code>iptables -I OUTPUT -p tcp --dport 22 -d 10.0.1.14 -j DROP</code>表示：把发送到10.0.1.14的22端口的数据包丢掉。</li>
<li><code>iptables -A INPUT -s 192.168.1.0/24 -i eth0 -j ACCEPT</code>表示：把来自192.168.1.0/24这个网段的并且作用在eth0网卡上的包放行。</li>
</ul>
</li>
</ul>
<p>规则总结：</p>
<ul>
<li>-A/-D ：增加或删除一条规则</li>
<li>-I ：插入一条规则，其实跟-A的效果差不多（如果想让一条规则最优先生效，那么就用-I插入一条规则）</li>
<li>-p ：指定协议，可以是tcp、udp、icmp</li>
<li>–dport ：跟-p一起使用，指定目标端口</li>
<li>–sport ：跟-p一起使用，指定源端口</li>
<li>-s ：指定源IP（可以是一个IP段）</li>
<li>-d ：指定目的IP（可以是一个IP段）</li>
<li>-j ：后跟动作，其中ACCEPT表示允许包，DROP表示丢掉包，REJECT表示拒绝包</li>
<li>-i ：指定网卡（不常用，但有时候能够用到）</li>
</ul>
<h3 id="4-2-4-删除一条规则的简便方法"><a href="#4-2-4-删除一条规则的简便方法" class="headerlink" title="4.2.4. 删除一条规则的简便方法"></a>4.2.4. 删除一条规则的简便方法</h3><p>当iptables的规则过多时，想删除某一条规则时，又不容易掌握当时创建时的规则。其实有一种比较简单的方法，如下所示：</p>
<ul>
<li><code>iptables -nvL --line-numbers</code> 查看规则的内容和编号</li>
<li><code>iptables -D INPUT 1</code> 删除编号为1的规则<ul>
<li>-D后面跟链名，然后是规则编号n，这个n就是查看iptables规则时第一列的值。</li>
</ul>
</li>
</ul>
<h3 id="4-2-5-iptables的-P（大写）选项"><a href="#4-2-5-iptables的-P（大写）选项" class="headerlink" title="4.2.5. iptables的-P（大写）选项"></a>4.2.5. iptables的-P（大写）选项</h3><p>iptables还有一个选项经常用到，就是-P（大写），表示预设策略。用法如下：</p>
<ul>
<li><code>iptables -P INPUT DROP</code><ul>
<li>说明：-P后面跟链名，策略内容或者为DROP或者为ACCEPT，默认是ACCEPT。</li>
<li>注意：如果你在远程链接服务器，千万不要随便敲这个命令，因为一旦敲完回车后你就会断掉。</li>
<li>这个策略一旦设定后，只能使用<code>iptables -P INPUT ACCEPT</code>才能回复成原始状态，而不能使用-F参数。</li>
</ul>
</li>
</ul>
<p>下面针对一个小需求讲解一下这个iptables规则如何设定：、</p>
<ul>
<li>需求：之针对filter表，预设策略INPUT链DROP，其他两个ACCEPT，然后针对192.168.137.0/24开通22端口，对所有网段开放80端口，对所有网段开放21端口。</li>
<li><p>解决方法：这个需求不算复杂，但是因为有很多条规则，所以最好写成脚本的形式。脚本内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /usr/local/sbin/iptables.sh</span></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line">ipt=<span class="string">"/sbin/iptables"</span></div><div class="line"><span class="variable">$ipt</span> -P INPUT DROP</div><div class="line"><span class="variable">$ipt</span> -P OUTPUT ACCEPT</div><div class="line"><span class="variable">$ipt</span> -P FORWARD ACCEPT</div><div class="line"><span class="variable">$ipt</span> -A INPUT -s 192.168.137.0/24 -p tcp --dport 22 -j ACCEPT</div><div class="line"><span class="variable">$ipt</span> -A INPUT -p tcp --dport 80 -j ACCEPT</div><div class="line"><span class="variable">$ipt</span> -A INPUT -p tcp --dport 21 -j ACCEPT</div></pre></td></tr></table></figure>
</li>
<li><p>完成脚本的编写后，直接运行<code>/bin/sh /usr/local/sbin/iptables.sh</code>即可。</p>
</li>
<li>如果想开机启动时初始化防火墙规则，则需要在/etc/rc/d/rc.local中添加一行<code>/bin/sh /usr/local/sbin/iptables.sh</code></li>
</ul>
<h3 id="4-2-6-关于icmp的包的一个常见应用"><a href="#4-2-6-关于icmp的包的一个常见应用" class="headerlink" title="4.2.6. 关于icmp的包的一个常见应用"></a>4.2.6. 关于icmp的包的一个常见应用</h3><p><code>iptables -I INPUT -p icmp --icmp-type 8 -j DROP</code></p>
<p>说明：<code>--icmp-type</code>这个选项要跟<code>-p icmp</code>一起使用的，后面指定类型编号。这个8指的是能在本机ping通其他机器，而其他机器不能ping通本机。这个有必要记一下。</p>
<h2 id="4-3-nat表的应用"><a href="#4-3-nat表的应用" class="headerlink" title="4.3. nat表的应用"></a>4.3. nat表的应用</h2><p>引言：在日常生活中相信你接触过路由器吧，它的功能就是分享上网。本来一根网线过来（其实只有一个公网IP），通过路由器后，路由器分配了一个网段（私网IP），这样连接路由器的多台设备就都能够连接网络了。而远端的设备认为你的IP就是那个连接路由器的公网IP。这个luyouqi的功能其实就是由Linux的netfilter的nat表实现的。</p>
<p>需求：假设你的机器上有两块网卡eth0和eth1，其中eth0的IP为10.0.2.68，eth1的IP为192.168.1.1。eth0连接了网络，但eth1没有连接，现在有另一台机器（192.168.1.2）和eth1是互通的，那么如何设置也能够让连接eth1的这台机器能够连上网络呢（即能和10.0.2.68互通）？</p>
<p>解决方法如下：</p>
<ul>
<li><code>echo &quot;1&quot; &gt; /proc/sys/net/ipv4/ip forward</code></li>
<li><code>iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o eth0 -j MASQUERADE</code></li>
<li>说明：<ul>
<li>就是这样简单的两条命令就能实现上面的需求。第一个命令涉及到了内核参数相关的配置文件，它的目的是为了打开路由转发的功能，否则无法实现我们的应用。</li>
<li>第二个命令则是对nat表做了一个IP转发的操作，-o选项后面跟设备名，表示出口的网卡，MASQUERADE表示伪装的意思。</li>
<li>关于nat表，暂时先不讲太多内容，只需要学会这个路由转发即可。</li>
</ul>
</li>
</ul>
<h2 id="4-4-保存以及备份iptables规则"><a href="#4-4-保存以及备份iptables规则" class="headerlink" title="4.4. 保存以及备份iptables规则"></a>4.4. 保存以及备份iptables规则</h2><ul>
<li>保存：<ul>
<li>设定的防火墙规则只是保存在内存中，并没有保存到某一个文件中，也就是说当系统重启后以前设定的规则就没有了，所以设定规则后要先保存一下。、</li>
<li><code>service iptables save</code></li>
<li>它会提示防火墙规则保存在了/etc/sysconfig/iptables文件内，这个文件就是iptables的配置文件了。</li>
</ul>
</li>
<li>备份：<ul>
<li>所谓防火墙的备份就是把防火墙的配置文件/etc/sysconfig/iptables备份一下</li>
</ul>
</li>
<li>有时候我们会需要把防火墙的所有规则都清除，使用<code>iptables -F</code>命令虽然可以，但是最好的办法是把防火墙服务停止：<ul>
<li><code>service iptables stop</code></li>
<li>说明：这样防火墙就失效了，但是一旦重新设定规则后（哪怕只有一条），防火墙服务就会自动开启。</li>
</ul>
</li>
<li>一个用来备份和还原防火墙规则的命令：<ul>
<li>备份：<code>iptables-save &gt; myipt.rule</code></li>
<li>还原：<code>iptables-restore &lt; myipt.rule</code></li>
</ul>
</li>
</ul>
<hr>
<h1 id="5-Linux系统的任务计划"><a href="#5-Linux系统的任务计划" class="headerlink" title="5. Linux系统的任务计划"></a>5. Linux系统的任务计划</h1><h2 id="5-1-crontab-命令"><a href="#5-1-crontab-命令" class="headerlink" title="5.1. crontab 命令"></a>5.1. crontab 命令</h2><p>Linux的任务计划功能的操作都是通过这个<code>crontab</code>命令来完成的。在配置文件/etc/crontab中可以查看计划任务配置的规则，其中常用的选项有：</p>
<ul>
<li>-u：指定某个用户，不加-u选项则为当前用户</li>
<li>-e：制定计划任务</li>
<li>-l：列出计划任务</li>
<li>-r：删除计划任务</li>
</ul>
<p>以一个例子来说明其设置的格式：</p>
<ul>
<li><code>crontab -e</code> 回车后输入如下内容：  <code>01 10 05 06 3 echo &quot;ok&quot; &gt; /root/cron.log</code></li>
<li>这样就增加了一条计划任务，关于计划任务内容的说明如下：<ul>
<li>每个字段的数字分别表示（从左到右）：分、时、日、月、周、命令。</li>
<li>上一个例子的含义是：在6月5日（这一天必须是星期三）的10点01分执行命令echo “ok” &gt; /root/cron.log。</li>
<li><code>crontab -e</code>命令实际上是打开了配置文件/var/spool/cron/username（如果是root用户，则打开的是/var/spool/cron/root）,所使用的编辑器是vi，所以要保存的话则需要在命令模式下输入”:/wq”即可。</li>
<li>注意：千万不要直接去编辑那个文件，因为可能会出错，所以一定要使用命令<code>crontab -e</code>来编辑。</li>
</ul>
</li>
</ul>
<p>使用该命令的其他常用用法：</p>
<ul>
<li><code>crontab -l</code> ：查看已经设定的任务计划</li>
<li><code>crontab -r</code> ：删除任务计划</li>
</ul>
<h2 id="5-2-关于任务计划的练习"><a href="#5-2-关于任务计划的练习" class="headerlink" title="5.2. 关于任务计划的练习"></a>5.2. 关于任务计划的练习</h2><p>题目如下：</p>
<ol>
<li>每天凌晨1点20分清除/var/log/slow.log这个文件</li>
<li>每周日3点执行”/bin/sh /usr/local/sbin/backup.sh”</li>
<li>每月14号4点10分执行”/bin/sh /usr/local/sbin/backup_month.sh”</li>
<li>每隔8小时执行”ntpdate time.windows.com”</li>
<li>每天的1点、12点、18点执行”/bin/sh /usr/local/sbin/test.sh”</li>
<li>每天的9点到18点执行”/bin/sh /usr/local/sbin/test2.sh”</li>
</ol>
<p>答案如下：</p>
<ol>
<li><code>20 1 * * * echo &quot;&quot; &gt; /var/lpg/slow.log</code></li>
<li><code>0 3 * * 0 /bin/sh /usr/local/sbin/backup.sh</code></li>
<li><code>10 4 14 * * /bin/sh /usr/local/sbin/backup_month.sh</code></li>
<li><code>0 */8 * * * ntpdate time.windows.com</code></li>
<li><code>0 1,12,18 * * /bin/sh /usr/local/sbin/test.sh</code></li>
<li><code>0 9-18 * * * /bin/sh /usr/local/sbin/test2.sh</code></li>
</ol>
<p>说明：</p>
<ol>
<li>每隔8小时，就是用全部小时（0-23）去除以8,其实算出来应该是0、8、16三个数。</li>
<li>当遇到多个数（分钟、小时、月、周）例如第5题，则需要用都好隔开。</li>
<li>而时间段是可以用n-m的方式表示的，比如第6题中的9-18</li>
<li>在设置好所有的计划任务后需要查看一下crond服务是否启动：<code>service crond status</code></li>
</ol>
<hr>
<h1 id="6-Linux系统服务管理"><a href="#6-Linux系统服务管理" class="headerlink" title="6. Linux系统服务管理"></a>6. Linux系统服务管理</h1><p>有些服务我们日常用不到则要把它们停掉，一来可以节省资源，二来可以减少安全隐患。</p>
<h2 id="6-1-ntsysv服务配置工具"><a href="#6-1-ntsysv服务配置工具" class="headerlink" title="6.1. ntsysv服务配置工具"></a>6.1. ntsysv服务配置工具</h2><p>如果没有这个命令请使用<code>yum install -y ntsysv</code>来安装它。这个工具用来配置哪些服务开启或者关闭，有点类似图形界面，不过是使用键盘来控制的。</p>
<p>直接运行命令<code>ntsysv</code>回车后弹出一个配置界面，如图：<br><img src="http://ooww3ll01.bkt.clouddn.com/pngntsysv.png" alt="ntsysv"></p>
<p>按键盘的上下方向键可以调节红色光标，按空格可以选择开启或者不开启，如果前面的括号内显示有*，则表示开启，否则不开启。通过这个工具也可以查看的到目前系统中所有的服务。</p>
<p>建议除”crond、iptables、network、sshd、syslog、irqbalance、sendmail、microcode_ctl”外的其他服务全部停掉。</p>
<p>选择好后，按tab键选择”确定”，然后回车，需要重启机器才能生效。</p>
<h2 id="6-2-chkconfig服务管理工具"><a href="#6-2-chkconfig服务管理工具" class="headerlink" title="6.2. chkconfig服务管理工具"></a>6.2. chkconfig服务管理工具</h2><p>总结：</p>
<ul>
<li>Linux系统所有的预设服务可以查看/etc/init.d/目录得到：<code>ls /etc/init.d/</code>。</li>
<li>系统预设服务都是可以通过这样的命令实现：<code>service 服务名 &quot;start|stop|restart&quot;</code>来控制。</li>
<li>除了可以使用<code>servuce crond start</code>启动crond外，还可以使用<code>/etc/init.d/crond start</code>来启动。</li>
<li>使用<code>chkconfig --list</code>列出所有的服务以及每个级别事都开启。</li>
<li>我们还可以使用grep命令把我们想要查看的服务过滤出来：<code>chkconfig --list | grep cron</code></li>
<li>更改某个级别下服务的开启（一个例子）：<code>chkconfig --level 3 crond off</code><ul>
<li>用–level指定级别，后面是服务名，然后是off或者on，–level后面还可以跟多个级别：<code>chkconfig --level 345 crond off</code></li>
<li>另外还可以省略级别，默认是针对2,3,4,5级别操作：<code>chkconfig crond on</code></li>
</ul>
</li>
</ul>
<p>关于chkconfig：</p>
<ul>
<li>还有一个功能就是可以把某个服务加入到系统服务，即可以使用<code>service 服务名 start</code>这样的形式，并且可以在<code>chkconfig --list</code>中查找到。当然也能删除掉。</li>
<li>下面的这个功能常用在把自定义的启动脚本加入到系统服务当中。<ul>
<li><code>chkconfig --del crond</code></li>
<li><code>chkconfig --list | grep cron</code></li>
<li><code>chkconfig --add crond</code></li>
<li><code>chkconfig --list | grep cron</code></li>
</ul>
</li>
</ul>
<hr>
<h1 id="7-Linux下的数据备份工具"><a href="#7-Linux下的数据备份工具" class="headerlink" title="7. Linux下的数据备份工具"></a>7. Linux下的数据备份工具</h1><h2 id="7-1-scp工具"><a href="#7-1-scp工具" class="headerlink" title="7.1. scp工具"></a>7.1. scp工具</h2><p>scp用来拷贝用的，可远程和本地相互之间都可以，与rsync差不多，但是它不支持增量备份。</p>
<p>用法如下：</p>
<ul>
<li><code>scp</code>是由<code>openssh-clients</code>包支持的，安装这个包就可以使用scp了，但是远程备份的时候双方都必须安装这个包。</li>
<li><code>scp -r a/ 192.168.1.12:/tmp/b/</code> 把a目录拷贝到IP的/tmp/下更名为b，IP前不加用户名默认使用root。</li>
<li><code>scp -r a/ root@192.168.1.12&quot;/tmp/a/&quot;</code> 从本地拷贝到远程</li>
<li><code>scp -r 192.168.1.12:/tmp/a/ ./a/</code> 从远程拷贝到本地</li>
</ul>
<h2 id="7-2-rsync工具"><a href="#7-2-rsync工具" class="headerlink" title="7.2. rsync工具"></a>7.2. rsync工具</h2><h3 id="7-2-1-介绍"><a href="#7-2-1-介绍" class="headerlink" title="7.2.1. 介绍"></a>7.2.1. 介绍</h3><p>在Linux 系统下的数据备份的工具有很多，但其实只用一种就可以满足所有的备份工作，那就是rsync这个工具。从字面上的意思可以理解为<code>remove sync（远程同步）</code>，这样可以理解的更深刻一些。</p>
<p>rsync工具不仅可以远程同步数据（类似于scp)，当然还可以本地同步数据（类似于cp）。但不同于两者的是，rsync工具不会覆盖以前的数据（如果数据已经存在），它会先判断已经存在的数据和新数据有什么不同，只有不同时才会把不同的部分覆盖掉。远程备份和增量备份是它的优势。</p>
<p>如果Linux系统中没有这个工具，请先安装它：<code>yum install -y rsync</code>。</p>
<h3 id="7-2-2-使用"><a href="#7-2-2-使用" class="headerlink" title="7.2.2. 使用"></a>7.2.2. 使用</h3><p>使用格式：</p>
<ul>
<li><code>rsync 源 目标</code> //本地</li>
<li><code>rsync 源 userbname@ip:目标</code> //上传到远程去</li>
<li><code>rsync username@ip:源文件 目标</code> //下载到本地来</li>
<li><code>rsync 源 username@ip::模块名</code></li>
<li><code>rsync username@ip::模块名 目标</code></li>
</ul>
<p>常用选项：</p>
<ul>
<li>(常用)<code>-a</code> 归档模式，相当于选项 <code>-rlptgoD</code></li>
<li>(常用)<code>-v</code> 显示信息，显示文件拷贝的状态等信息</li>
<li>(常用)<code>--delete</code> 删除那些DST中SRC没有的文件</li>
<li>(常用)<code>--exclude=PATTERN</code> 指定排除不需要传输的文件，等号后面跟目录i，支持通配符（如*.txt)</li>
<li>(常用)<code>--password-file=filename</code> 指定密码文件</li>
<li>(常用)<code>rsync --daemon</code> 后台模式启动<ul>
<li><code>rsync --daemon --help</code> 可查看帮助文件</li>
<li><code>rsync --daemon --config=/etc/rsyncd.conf</code> 指定配置文件，默认使用/etc/rsyncd.conf配置文件</li>
</ul>
</li>
<li><code>-r</code> 针对目录，对子目录以递归模式处理</li>
<li><code>-l</code> 针对软链接文件来使用，保持软链接文件的本身类型</li>
<li><code>-L</code> 把软链接所指向的源文件拷贝</li>
<li><code>-u</code> 加上这个选项后将会把DST中比SRC还新的文件排除掉，不会覆盖</li>
<li><code>-p</code> 保留权限</li>
<li><code>-t</code> 保留时间属性</li>
<li><code>-g</code> 保留所属组信息</li>
<li><code>-o</code> 保留所属主信息</li>
<li><code>-D</code> 保持设备文件信息（只针对超级用户使用，目前还不理解）</li>
<li><code>a --no-l</code> 在a选项中去除l选项</li>
<li><code>-z</code> 压缩传输</li>
<li><code>-P或--progress</code> 在同步的过程中可以看到同步的过程状态，比如统计要同步的文件数量、同步的文件传输速度等等。</li>
<li><code>--bwlimit=100</code> 限速，最大传输速度为100kb</li>
</ul>
<h3 id="7-2-3-一些重要的实验"><a href="#7-2-3-一些重要的实验" class="headerlink" title="7.2.3. 一些重要的实验"></a>7.2.3. 一些重要的实验</h3><ul>
<li>建立目录以及文件<ul>
<li><code>mkdir rsync</code></li>
<li><code>cd rsync</code></li>
<li><code>mkdir test1</code></li>
<li><code>cd test1</code></li>
<li><code>touch 1 2 3</code></li>
<li><code>ln -s /root/123.txt ./123.txt</code></li>
<li><code>ls -l</code></li>
<li>建立这些文件的目的就是为了做实验做一些准备工作。</li>
</ul>
</li>
<li>使用<code>-a</code>选项<ul>
<li><code>rsync -a test1 test2</code></li>
<li><code>ls test2</code></li>
<li><code>ls test2/test/</code></li>
<li>这里有一个问题，就是本想把test1目录直接拷贝成test2目录，可结果rsync却新建了test2目录然后把test1放到了test2当中。为了避免这样的情况发生，可以这样做：</li>
<li><code>rm -rf test2</code></li>
<li><code>rsync -a test1/ test2/</code></li>
<li><code>ls -l test2/</code></li>
<li>加一个斜杠就好了，所以我建议你在使用rsync备份目录时要养成加斜杠的习惯。</li>
<li>在上面讲了-a选项等同于-rlptgoD，而且-a还可以和–no-OPRIN一并使用。</li>
</ul>
</li>
<li>下面来看看<code>-l</code>选项的作用<ul>
<li><code>rsync -av --no-l test1/ test2/</code></li>
<li>使用-v选项看来就是很方便，上例告诉我们跳过了非普通文件123.txt，其实123.txt是一个软链接文件，如果不使用-l选项则不理会软链接文件。</li>
<li>虽然加上-l选项会把软链接文件给拷贝过去，但是软链接的目标文件却没有拷贝过去，有时候咱们指向拷贝软链接文件所指向的目标文件，那这时候该怎么办呢？</li>
</ul>
</li>
<li>使用<code>-L</code>选项<ul>
<li><code>rsync -avL test1/ test2/</code></li>
<li><code>ls -l test2/</code></li>
<li>加上-L选项就可以把SRC中软链接的目标文件给拷贝到DST。</li>
</ul>
</li>
<li>使用<code>-u</code>选<ul>
<li>首先查看一下test/1和test2/1的创建时间（肯定是一样的），然后使用touch修改一下test2/1的创建时间（此时test2/1要比/test1/1的创建时间晚了一些）。如果不加-u选项的花，会把test2/1的创建时间变成和test1/1的创建时间一样。这样讲也许会让人迷糊，不妨看一看：</li>
<li><code>ll test1/1 test2/1</code> 两者之间的创建时间是一样的，下面修改test2/1的创建时间，然后不加-u同步</li>
<li><code>touch test2/1</code></li>
<li><code>ll test2/1</code></li>
<li><code>rsync -av test1/ test2/</code></li>
<li><code>ll test2/1</code></li>
<li>test2/1的创建时间又变成和test1/1的创建时间一样了。下面加上-u选项再看看结果是怎样的</li>
<li><code>touch test2/1</code></li>
<li><code>ll test2/1</code></li>
<li><code>rsync -avu test1/ test2/</code></li>
<li><code>ll test1/1 test2/1</code></li>
<li>加上-u选项后，不会再把test1/1同步为test2/1了，这就是-u选项的妙用。</li>
</ul>
</li>
<li>使用<code>--delete</code>选项<ul>
<li>首先删除test1/123.txt  <code>rm -rf test1/123.txt</code></li>
<li>`ls test1/</li>
<li>然后把test1/目录同步到test2/目录下 <code>rsync -av test1/ test2/</code></li>
<li><code>ls test2/</code></li>
<li>test2/目录下并没有删除掉123.txt，下面加上–delete选项 <code>rsync -av --delete test1/ test2/</code></li>
<li><code>ls test2/</code></li>
<li>test2/目录下的123.txt也被删除了，这就是–delete选项的用处。</li>
<li>还有一种情况就是如果在DST增加文件，而SRC当中没有这些文件，同步时加上–delete选项后同样会删除新增的文件。</li>
<li><code>touch test2/4</code></li>
<li><code>ls test1/ test2/</code></li>
<li><code>rsync -a --delete test1/ test2/</code></li>
<li><code>ls test1/ test2/</code></li>
</ul>
</li>
<li>使用–exclude选项<ul>
<li><code>touch test1/4</code></li>
<li><code>rsync -a --exclude=&quot;4&quot; test1/ test2/</code></li>
<li><code>ls test1/ test2/</code></li>
<li>另外还可以使用匹配字符*</li>
<li><code>touch test1/1.txt test1/2.txt</code></li>
<li><code>ls test1/ test2/</code></li>
<li><code>rsync -a --progress --exclude=&quot;\*.txt&quot; test1/ test2/</code></li>
<li><code>ls test2/</code></li>
<li>上例中，连带着使用了–progress选项，这个主要是用来观察rsync同步过程的状态的。</li>
</ul>
</li>
<li>最后简单总结一下，在平时使用rsync同步数据的时候，使用-a选项基本上就可以达到我们想要的效果了，只是有时候有个别的需求，会用到-a -no-OPTION、-u、-L、–delete、–exclude以及–progress这些选项，还有些选项虽然没有介绍，但是在以后的工作中遇到特殊需求了，就去查一下rsync的man文档吧。</li>
</ul>
<h3 id="7-2-4-rsync同步之ssh隧道方式（干货）"><a href="#7-2-4-rsync同步之ssh隧道方式（干货）" class="headerlink" title="7.2.4. rsync同步之ssh隧道方式（干货）"></a>7.2.4. rsync同步之ssh隧道方式（干货）</h3><p>在之前介绍的5种方式当中，第二、第三（一个冒号）就属于通过ssh的方式，这种方式其实就是让用户去登陆到远程机器，然后执行rsync的任务。因为用到了ssh，所以必须要俺扎u嗯<code>openssh-clients</code>包才可以，两台机器都安装一下：<code>yum install -y openssh-clients</code>。</p>
<ul>
<li><code>rsync -avL test1/ www@192.168.0.101:/tmp/test2/</code><ul>
<li>这种方式就是前面介绍的第二种方式了，是通过ssh拷贝的数据，需要输入192.168.0.101那台机器WWW账户的密码。</li>
</ul>
</li>
<li><code>rsync -avL www@192.168.0.101:/tmp/test2/ ./test3/</code><ul>
<li>这种方式就是第三种拷贝的方式了。</li>
</ul>
</li>
</ul>
<p>以上两种方式如果写到脚本里，备份起来就有麻烦看了，因为要输入密码，脚本本来就是自动的，不可能做到。但是不代表没有解决办法，那就是通过密钥验证，密钥不设立密码就ok了。方法如下：</p>
<ul>
<li>在操作之前我们先讲明主机信息：192.168.0.10（主机名Aming-1）和192.168.0.101（主机名Aming），需要从Aming-1上拷贝数据到Aming上。首先确认一下Aming-1上是否有这个文件/root/.ssh/id_rsa.pub</li>
<li>如果没有这个文件，按照下面的方法生成：<ul>
<li><code>ssh-keygen</code></li>
<li>在这个过程中会有一些交互的过程，它首先提示要输入这个密钥的密码，出于安全考虑应该定义个没密码，但是我们的目的就是为了自动化同步数据，所以这里不输入任何密码，直接回车，即密码为空。最后则生成了私钥（/root/.ssh/id_rsa）和公钥（/root/.ssh/id_rsa.pub）。</li>
<li>把公钥文件的内容拷贝到目标机器上：<code>cat .ssh/id_rsa.pub</code>，复制内容</li>
<li>复制主机Aming-1的/root/.ssh/id_rsa.pub文件内容，并粘贴到主机Aming的/home/www/.ssh/authorized_keys中：<ul>
<li><code>vi /home/www/.ssh/authorized_keys</code></li>
<li>在这一步也许您会遇到/home/www/.ssh目录不存在的问题，可以手动创建，并修改目录权限为600,也可以执行<code>ssh-keygen</code>命令生成这个目录。</li>
</ul>
</li>
<li>保存/home/.ssh/authorized_keys文件后，再到主机Aming-1上执行：<ul>
<li><code>ssh www@192.168.0.101</code></li>
<li>现在不用输入密码也可以登陆主机Aming了。</li>
</ul>
</li>
</ul>
</li>
<li>下面先从Aming主机退出来，再从主机Aming-1上执行一下rsync命令试试吧：<ul>
<li><code>rsync -av rsync/test1/ www@192.168.0.101:/tmp/test4/</code></li>
</ul>
</li>
</ul>
<h3 id="7-2-5-rsync后台服务方式"><a href="#7-2-5-rsync后台服务方式" class="headerlink" title="7.2.5. rsync后台服务方式"></a>7.2.5. rsync后台服务方式</h3><p>这种方式可以理解成这样，在远程主机上建立一个rsync的服务器，在服务器上配置好rsync的各种应用，然后本机作为rsync的一个客户端去连接远程的rsync服务器。</p>
<p>如何去配置一台rsync服务器呢？如下所示：</p>
<ul>
<li><p>建立并配置rsync的配置文件<code>/etc/rsyncd.conf</code></p>
<ul>
<li><p><code>vi /etc/rsyncd.conf</code> 加入如下内容：</p>
  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#port=873</span></div><div class="line">log <span class="attribute">file</span>=/var/log/rsync.log</div><div class="line">pid <span class="attribute">file</span>=/var/run/rsyncd.pid</div><div class="line"><span class="comment">#address=192.168.0.10</span></div><div class="line">[test]</div><div class="line"><span class="attribute">path</span>=/root/rsync</div><div class="line">use <span class="attribute">chroot</span>=<span class="literal">true</span></div><div class="line">max <span class="attribute">connections</span>=4</div><div class="line">read <span class="attribute">only</span>=<span class="literal">no</span></div><div class="line"><span class="attribute">list</span>=<span class="literal">true</span></div><div class="line"><span class="attribute">uid</span>=root</div><div class="line"><span class="attribute">gid</span>=root</div><div class="line">auth <span class="attribute">users</span>=test</div><div class="line">secrets <span class="attribute">file</span>=/etc/rsyncd.passwd</div><div class="line">hosts <span class="attribute">allow</span>=192.168.0.101</div></pre></td></tr></table></figure>
</li>
<li><p>其中的配置文件分为两部分：全局配置部分和模块配置部分。全局部分就是i几个参数而已，就像上例中的port、log file、pid file、address这些都属于全局配置，而[test]以下的部分就是模块配置部分了。</p>
</li>
<li>一个配置文件中可以有多个模块，模块名自定义，格式就像上例中的这样。其实模块中的一些参数例如use chroot、max connections、uid、gid、auth users、secrets file以及hosts allow都可以配置成全局的参数。当然上例所给出的参数并不是全部的，你可以通过man rsyncd.cong获得更多帮助信息。</li>
<li>下面简单解释一下这些参数的意义：<ul>
<li><code>port</code> 指定在哪个端口启动rsync服务，默认是873端口</li>
<li><code>log file</code> 指定日志文件</li>
<li><code>pid file</code> 指定pid文件，这个文件的作用涉及到服务的启动以及停止等进程管理操作</li>
<li><code>address</code> 指定启动rsyncd服务的IP，假如你的机器有多个IP，就可以指定其中一个启动rsyncd服务，默认是在全部IP上启动</li>
<li><code>[test]</code> 指定模块名，自定义</li>
<li><code>path</code> 指定数据存放的路径</li>
<li><code>use chroot true|false</code> 默认是true，意思是在传输文件以前首先chroot到path参数所指定的目录下。这样做的原因是实现额外的安全防护，但是缺点是需要以root权限，并且不能备份指向外部的符号链接所指向的目录文件。默认情况下chroot值为true，如果你的数据当中有软链接文件的话建议设置成false</li>
<li><code>max connections</code> 指定最大的连接数，默认是0,即没有限制</li>
<li><code>read only true|false</code> 如果为true则不能上传到该模块指定的路径下</li>
<li><code>list</code> 指定当用户查询该服务器上的可用模块时，该模块是否被列出，设定true列出，false隐藏</li>
<li><code>uid和gid</code> 指定传输文件时，以哪个用户和组的身份传输</li>
<li><code>auth users</code> 至i的嗯传输时要使用的用户名</li>
<li><code>secrets file</code> 指定密码文件，该参数连同上面的参数如果不指定则不使用密码验证，注意该密码文件的权限一定要是600</li>
<li><code>hosts allow</code> 指定被允许连接该模块的主机，可以是IP或者网段，如果是多个，之间用空格隔开</li>
</ul>
</li>
</ul>
</li>
<li>编辑secrets file，保存后修改权限为600，如果权限部队，不能完成同步<ul>
<li><code>cat /etc/rsyncd.passwd</code></li>
<li><code>chmod 600 /etc/rsyncd.passwd</code></li>
</ul>
</li>
<li>启动rsyncd服务<ul>
<li><code>rsync --daemon --config=/etc/rsyncd.conf</code></li>
</ul>
</li>
<li>启动后，可以查看一下日志，并查看端口是否启动：<ul>
<li><code>cat /var/log/rsync.log</code></li>
<li><code>netstat -lnp | grep 873</code></li>
</ul>
</li>
<li>如果想开机启动，请把命令<code>rsync --daemon --config=/etc/rsyncd.conf</code>写入到<code>/etc/rc.d/rc.local</code>文件</li>
<li>到另一台机器上测试：<ul>
<li><code>rsync -avL test@192.168.0.10::test/test1/ /tmp/test5/</code></li>
</ul>
</li>
<li>有一个选项叫做”use chroot”默认为<code>true</code>，如果是<code>true</code>，同步的文件中如果有软链接，则会有问题，而把主机Aming-1的rsync配置文件修改一下，把该配置语句的值设置为<code>false</code>，这样就没有任何问题了。</li>
</ul>
<h3 id="7-2-6-最后的说明"><a href="#7-2-6-最后的说明" class="headerlink" title="7.2.6. 最后的说明"></a>7.2.6. 最后的说明</h3><p>上面的那个例子中，都有输入密码，这样同样也不能写入到脚本中自动执行，其实这种方式也是可以不用手动输入密码的，它有两种实现方式：</p>
<ol>
<li>使用没有设置密码的密钥验证</li>
<li>指定密码文件<ul>
<li>在客户端上，也就是主机Aming上，编辑一个密码文件：<code>vim /etc/pass</code>，在其中加入test用户的密码，保存，修改密码文件的权限为600</li>
<li>在同步的时候，指定一下密码文件，就可以省去输入密码的步骤了<ul>
<li><code>rsync -avL test@192.168.0.10::test/test1/ /tmp/test8/ --password-file=/etc/pass</code></li>
</ul>
</li>
</ul>
</li>
</ol>
<hr>
<h1 id="8-Linux系统日志"><a href="#8-Linux系统日志" class="headerlink" title="8. Linux系统日志"></a>8. Linux系统日志</h1><h2 id="8-1-日志配置文件"><a href="#8-1-日志配置文件" class="headerlink" title="8.1. 日志配置文件"></a>8.1. 日志配置文件</h2><p>日志的配置文件，CentOS6默认改为rsyslog.conf，之前的版本是syslog.conf。该配置文件的主要信息为：记录哪些服务和需要记录什么等级的信息。</p>
<p>日志的格式如下：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>auth</td>
<td>pam产生的日志</td>
</tr>
<tr>
<td>authpriv</td>
<td>ssh、FTP等登陆的验证信息</td>
</tr>
<tr>
<td>cron</td>
<td>时间任务相关</td>
</tr>
<tr>
<td>kern</td>
<td>内核</td>
</tr>
<tr>
<td>lpr</td>
<td>打印</td>
</tr>
<tr>
<td>mail</td>
<td>邮件</td>
</tr>
<tr>
<td>mark(syslog)</td>
<td>rsyslog服务内部的信息，时间标识</td>
</tr>
<tr>
<td>news</td>
<td>新闻组</td>
</tr>
<tr>
<td>user</td>
<td>用户程序产生的相关信息</td>
</tr>
<tr>
<td>uucp</td>
<td>unix to unix copy，unix主机之间相关的通讯</td>
</tr>
<tr>
<td>local 1~7</td>
<td>自定义的日志设备</td>
</tr>
</tbody>
</table>
<p>日志的级别如下：</p>
<table>
<thead>
<tr>
<th>级别</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>debug</td>
<td>有调试信息的，日志信息最多</td>
</tr>
<tr>
<td>info</td>
<td>一般信息的日志，最常用</td>
</tr>
<tr>
<td>notice</td>
<td>最艰苦有重要性的普通条件的信息</td>
</tr>
<tr>
<td>warning</td>
<td>警告级别</td>
</tr>
<tr>
<td>err</td>
<td>错误级别，阻止某个功能或者模块不能正常工作的信息</td>
</tr>
<tr>
<td>crit</td>
<td>严重级别，阻止整个系统或者真整个软件不能正常工作的信息</td>
</tr>
<tr>
<td>alert</td>
<td>需要立刻修改的信息</td>
</tr>
<tr>
<td>emerg</td>
<td>内核崩溃等严重信息</td>
</tr>
<tr>
<td>none</td>
<td>什么都不记录</td>
</tr>
<tr>
<td>说明</td>
<td>从上到下，级别从低到高，记录的信息越来越少</td>
</tr>
</tbody>
</table>
<p>连接符号如下：</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>.</td>
<td>表示大于或等于xxx级别的信息</td>
</tr>
<tr>
<td>.=</td>
<td>表示等于xxx级别的信息</td>
</tr>
<tr>
<td>.!</td>
<td>表示在xxx之外的等级信息</td>
</tr>
</tbody>
</table>
<h2 id="8-2-常用日志文件"><a href="#8-2-常用日志文件" class="headerlink" title="8.2. 常用日志文件"></a>8.2. 常用日志文件</h2><ul>
<li><code>/var/log/messages</code> 系统最核心的日志文件，假如某个服务没有定义日志，那么该服务产生的日志就会到这个文件中。该日志每周归档一次。它是如何归档的，是根据<code>/etc/logrotste.conf</code>来控制的。<code>/var./log/messages</code>由<code>syslogd</code>这个守护进程产生的，如果停掉这个服务则系统不会产生<code>/var/log/messages</code>。</li>
<li><code>/var/log/wtmp</code> 用来记录用户登陆历史，但是这个文件不能用<code>cat</code>直接查看，只能用<code>last</code>查看。</li>
<li><code>/var/log/btmp</code> 用来记录无效登陆历史，和wtmp类似，也不能用<code>cat</code>直接查看，只能用<code>last</code>查看。</li>
<li><code>/var/log/maillog</code> 用来记录邮件相关的信息，比如发给谁邮件，是否发送成功等信息。</li>
<li><code>/var/log/secure</code> 是一个安全认证相关的日志，比如系统用户登陆时，正常登陆或者登陆失败都会记录，另外ftp服务相关的登陆日志也会记录到这里面来。</li>
<li><code>dmesg</code> 这是一个命令，主要用来查看系统实时的硬件设备抛出的信息，如果硬盘异常或者网络异常在或者内核异常都会记录下来，只不过这些信息是存到内存里面的，系统重启后就消失了。</li>
<li><code>/var/log/dmesg</code> 这是一个日志，记录系统启动时硬件相关的信息。</li>
</ul>
<h2 id="8-3-last命令"><a href="#8-3-last命令" class="headerlink" title="8.3. last命令"></a>8.3. last命令</h2><p>last命令示例如下：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ last</div><div class="line">theshu   tty8         :0               Sat Oct  7 09:42    gone - <span class="literal">no</span> logout</div><div class="line">reboot  <span class="built_in"> system </span>boot  4.4.0-53-generic Sat Oct  7 09:41   still running</div><div class="line"></div><div class="line">wtmp begins Sat Oct  7 09:41:18 2017</div></pre></td></tr></table></figure></p>
<p>last命令用来查看登陆Linux历史信息，从左到右依次为账户名称、登陆终端、登陆客户端ip、登陆日期及时长。last命令输出的信息实际上是读取了二进制日志文件/var/log/wtmp。</p>
<h2 id="8-4-关于日志使用的建议"><a href="#8-4-关于日志使用的建议" class="headerlink" title="8.4. 关于日志使用的建议"></a>8.4. 关于日志使用的建议</h2><p>在日常的管理工作中要养成多看日志的习惯，尤其是一些应用的日志，比如apache、mysql、php等常用的软件，看它们的日志（错误日志）可以帮助排查问题以及监控它们的运行状况是否良好。</p>
<hr>
<h1 id="9-xargs-与-exec"><a href="#9-xargs-与-exec" class="headerlink" title="9. xargs 与 exec"></a>9. xargs 与 exec</h1><p>这两个工具都可以实现相同的功能，exec主要是和find一起配合使用，而xargs就要比exec用的地方要多。</p>
<h2 id="9-1-xargs应用"><a href="#9-1-xargs应用" class="headerlink" title="9.1. xargs应用"></a>9.1. xargs应用</h2><p>用一个例子来说明：</p>
<ul>
<li><code>echo &quot;121212121212&quot; &gt; 123.txt</code></li>
<li><code>ls 123.txt | xargs cat</code>（输出结果： 121212121212）</li>
<li>说明：它的作用就是把管道符前面的输出作为xargs后面命令的输入。它的好处在于就可以把本来两步或多步才能完成的任务简单一步就能完成。</li>
</ul>
<p>xargs常常和find命令一起使用：</p>
<ul>
<li>比如，查找当前目录创建时间大于10天的文件，然后再删除</li>
<li>具体命令为：<code>find . -mtime +10 | xargs rm</code></li>
<li>说明：这种应用是最为常见的，xargs后面的rm也可以加选项，当是目录时，就需要加-r选项了</li>
</ul>
<p>这个功能更神器”</p>
<ul>
<li>现在我有这样一个需求“查找当前目录下所有.txt文件，然后把这些.txt文件变成.txt_bak。正常情况下，我们不得不写脚本去实现，但是使用xargs就一步能实现这个目的。</li>
<li>命令操作如下：<ul>
<li><code>mkdir test</code></li>
<li><code>cd test</code></li>
<li><code>touch 1.txt 2.txt.3.txt.4.txt.5.txt</code></li>
<li><code>ls *.txt | xargs -n1 -i{} mv {} {}_baka</code></li>
<li>说明：<code>xargs -n1 -i{}</code>类似for循环，<code>-n1</code>意思是一个一个对象去处理，<code>-i{}</code>把前面的对象使用<code>{}</code>取代，<code>mv {} {}_bak</code>相当于<code>mv 1.txt 1.txt_bak</code></li>
<li>建议记住这个应用方法，很实用</li>
</ul>
</li>
</ul>
<h2 id="9-2-exec应用"><a href="#9-2-exec应用" class="headerlink" title="9.2. exec应用"></a>9.2. exec应用</h2><p>exec其实是find命令的一个选项。使用find命令时，经常使用一个选项就是这个exec了，可以达到和xargs同样的效果。</p>
<p>比如，查找当前目录创建时间大于10天的文件并删除它们：</p>
<ul>
<li><code>find . -mtime +10 -exec rm -rf {} \;</code></li>
<li>说明：这个命令中也是把<code>{}</code>作为前面find出来的文件的替代符，后面的<code>\</code>为<code>;</code>的脱义符，不然shell会把分号作为该行命令的结尾。</li>
</ul>
<p>另一个使用exec的实用功能，就是它同样可以实现刚刚上面批量修改文件名的需求：</p>
<ul>
<li><code>find ./* bak -exec mv {} {}_bak \;</code></li>
</ul>
<hr>
<h1 id="10-screen-工具介绍"><a href="#10-screen-工具介绍" class="headerlink" title="10. screen 工具介绍"></a>10. screen 工具介绍</h1><p>需求：要执行一个命令或者脚本，但是需要几个小时甚至几天，这就要考虑到一个问题，就是中途断网或出现其他意外情况，执行的任务中断了怎么办？你可以把命令或者脚本丢到后台去运行，不过这样做也不保险。下面就介绍两种方法来避免这样的问题发生。</p>
<h2 id="10-1-nohup命令"><a href="#10-1-nohup命令" class="headerlink" title="10.1. nohup命令"></a>10.1. nohup命令</h2><p><code>nohup sh /usr/local/sbin/sleep.sh &amp;</code></p>
<p>说明：直接加一个”&amp;”虽然丢到后台了，但是当退出该终端很有可能这个脚本也会退出的，而在前面加上nohup就没有问题了。nohup的作用就是不挂断地运行命令，把运行命令产生的日志都记录到nohup文件里。</p>
<h2 id="10-2-screen命令"><a href="#10-2-screen命令" class="headerlink" title="10.2. screen命令"></a>10.2. screen命令</h2><p>介绍：简单来说，screen是一个可以在多个进程之间多路复用一个物理终端的窗口管理器。scrren中有会话的概念，用户可以在一个screen会话中创建多个screen窗口，在每一个screen窗口中就像操作一个真是的SSH连接窗口那样。</p>
<p>如果系统中没有screen命令，请用<code>yum install -y screen</code>安装。</p>
<p>下面介绍一个screen的简单应用：</p>
<ul>
<li>打开一个会话，直接输入<code>screen</code>命令然后回车，进入screen会话窗口</li>
<li><code>screen -ls</code>查看已经打开的screen会话（在会话前会显示编号）</li>
<li><code>Ctrl+a 再按d</code>退出该screen会话，只是退出，并没有结束</li>
<li>结束会话输入<code>Ctrl+d</code>或者<code>exit</code></li>
<li>退出后还想再次登陆某个screen会话，使用<code>screen -r [scrren标号]</code>，当只有一个screen会话时，后面的编号是可以省略的。当你有某个需要长时间运行的命令或者脚本时就打开一个screen会话，然后运行该任务。按<code>Ctrl+a</code>再按<code>d</code>退出会话，不影响终端窗口上的任何操作。</li>
</ul>
<p>创建新的screen时，指定自定义名称：</p>
<ul>
<li><code>scrren -S aming</code></li>
<li>要想进入该screen，可以直接<code>screen -r aming</code></li>
</ul>
<hr>
<h1 id="11-crul命令"><a href="#11-crul命令" class="headerlink" title="11. crul命令"></a>11. crul命令</h1><p>curl命令是Linux系统命令行下用来简单测试web访问的工具。几个常用的选项要掌握：</p>
<ul>
<li><code>-x</code> 可以指定ip和端口，省略写hosts，方便实用，格式：<code>curl -xip:port www.baidu.com</code></li>
<li><code>-l</code> 可以把访问的内容省略掉，只显示状态码;<code>-v</code>可以显示详细过程。如：<code>curl -lv http://www.baidu.com</code></li>
<li><code>-u</code> 可以指定用户名和密码：<code>curl -u user:password http://123.com</code></li>
<li><code>-O（大写）</code> 直接下载页面或者对象：<code>curl -O http://study.lishiming.net/index.html</code></li>
<li>还可以使用<code>-o</code>自定义名字：<code>curl -o index2.html http://study.lishiming.net/index.html</code></li>
</ul>
<blockquote>
<p>结束</p>
</blockquote>
</div><div class="tags"></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/12/19/常用便携软件/" class="pre">常用便携软件</a><a href="/2017/09/21/FTP服务配置（Aming）/" class="next">FTP服务配置（Aming）</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-监控系统的状态"><span class="toc-text">1. 监控系统的状态</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-w-查看系统负载"><span class="toc-text">1.1. w 查看系统负载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-vmstat-监控系统状态"><span class="toc-text">1.2. vmstat 监控系统状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-top-显示进程所占用的系统资源"><span class="toc-text">1.3. top 显示进程所占用的系统资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-sar-监控系统状态"><span class="toc-text">1.4. sar 监控系统状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用法1-查看网卡流量-sar-n-DEV"><span class="toc-text">用法1. 查看网卡流量 sar -n DEV</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用法2-查看历史负载"><span class="toc-text">用法2. 查看历史负载</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-nload-查看网卡流量"><span class="toc-text">1.5. nload 查看网卡流量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-6-free-查看内存使用状况"><span class="toc-text">1.6. free 查看内存使用状况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-ps-查看系统进程"><span class="toc-text">1.7. ps 查看系统进程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-netstat-查看网络状况"><span class="toc-text">1.8. netstat 查看网络状况</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-抓包工具"><span class="toc-text">2. 抓包工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-tcpdump工具"><span class="toc-text">2.1. tcpdump工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-wireshark工具"><span class="toc-text">2.2. wireshark工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-Linux网络相关"><span class="toc-text">3. Linux网络相关</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-ifconfig-查看网卡IP"><span class="toc-text">3.1. ifconfig 查看网卡IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-给一个网卡设定多个IP"><span class="toc-text">3.2. 给一个网卡设定多个IP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-查看网卡连接状态"><span class="toc-text">3.3. 查看网卡连接状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-更改主机名"><span class="toc-text">3.4. 更改主机名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-设置DNS"><span class="toc-text">3.5. 设置DNS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-Linux的防火墙"><span class="toc-text">4. Linux的防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-SELinux介绍"><span class="toc-text">4.1. SELinux介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-iptables详解"><span class="toc-text">4.2. iptables详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-查看、清除和保存规则"><span class="toc-text">4.2.1. 查看、清除和保存规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-iptables的几个表"><span class="toc-text">4.2.2. iptables的几个表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-iptables的基本语法"><span class="toc-text">4.2.3. iptables的基本语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-删除一条规则的简便方法"><span class="toc-text">4.2.4. 删除一条规则的简便方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-iptables的-P（大写）选项"><span class="toc-text">4.2.5. iptables的-P（大写）选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-关于icmp的包的一个常见应用"><span class="toc-text">4.2.6. 关于icmp的包的一个常见应用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-nat表的应用"><span class="toc-text">4.3. nat表的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-保存以及备份iptables规则"><span class="toc-text">4.4. 保存以及备份iptables规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Linux系统的任务计划"><span class="toc-text">5. Linux系统的任务计划</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-crontab-命令"><span class="toc-text">5.1. crontab 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-关于任务计划的练习"><span class="toc-text">5.2. 关于任务计划的练习</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-Linux系统服务管理"><span class="toc-text">6. Linux系统服务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-ntsysv服务配置工具"><span class="toc-text">6.1. ntsysv服务配置工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-chkconfig服务管理工具"><span class="toc-text">6.2. chkconfig服务管理工具</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Linux下的数据备份工具"><span class="toc-text">7. Linux下的数据备份工具</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-scp工具"><span class="toc-text">7.1. scp工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-rsync工具"><span class="toc-text">7.2. rsync工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-介绍"><span class="toc-text">7.2.1. 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-使用"><span class="toc-text">7.2.2. 使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-一些重要的实验"><span class="toc-text">7.2.3. 一些重要的实验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-rsync同步之ssh隧道方式（干货）"><span class="toc-text">7.2.4. rsync同步之ssh隧道方式（干货）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-rsync后台服务方式"><span class="toc-text">7.2.5. rsync后台服务方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-6-最后的说明"><span class="toc-text">7.2.6. 最后的说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-Linux系统日志"><span class="toc-text">8. Linux系统日志</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-日志配置文件"><span class="toc-text">8.1. 日志配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-常用日志文件"><span class="toc-text">8.2. 常用日志文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-last命令"><span class="toc-text">8.3. last命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-关于日志使用的建议"><span class="toc-text">8.4. 关于日志使用的建议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-xargs-与-exec"><span class="toc-text">9. xargs 与 exec</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-xargs应用"><span class="toc-text">9.1. xargs应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-exec应用"><span class="toc-text">9.2. exec应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-screen-工具介绍"><span class="toc-text">10. screen 工具介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-nohup命令"><span class="toc-text">10.1. nohup命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-screen命令"><span class="toc-text">10.2. screen命令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-crul命令"><span class="toc-text">11. crul命令</span></a></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/入门Linux运维工程师需要学习的内容/">入门Linux运维工程师需要学习的内容</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/C和C-高手修炼之路/">C和C++高手修炼之路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/19/常用便携软件/">常用便携软件</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/01/Linux系统管理技巧（Aming）/">Linux系统管理技巧（Aming）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/FTP服务配置（Aming）/">FTP服务配置（Aming）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/shell脚本中的select循环/">shell脚本中的select循环</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/shell脚本基础语法/">shell脚本基础语法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/NFS服务简单配置（Aming）/">NFS服务简单配置（Aming）</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/18/已读书清单-武侠/">已读书清单-武侠</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/18/已读书清单-科幻/">已读书清单-科幻</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vim/">Vim</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RegularExpression/">正则表达式</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zhuanzai/">转载</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">奇怪先生theshu.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>