<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="奇怪先生的博客"><title>Linux系统的启动流程 | 奇怪先生的博客</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Linux系统的启动流程</h1><a id="logo" href="/.">奇怪先生的博客</a><p class="description">耳目得来终觉浅，觉知此事要躬行。</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Linux系统的启动流程</h1><div class="post-meta"><a href="/2017/08/26/Linux/002. Linux系统的启动流程/#comments" class="comment-count"></a><p><span class="date">Aug 26, 2017</span><span><a href="/categories/Linux/" class="category">Linux</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><blockquote>
<p>GO</p>
</blockquote>
<h1 id="1-Linux系统的启动流程"><a href="#1-Linux系统的启动流程" class="headerlink" title="1. Linux系统的启动流程"></a>1. Linux系统的启动流程</h1><p>了解系统的启动流程，能够让我们在Linux系统在启动过程中遇到故障时，可以很快速地找到是在哪一步遇到了问题，这样我们就可以针对性地去排查故障。（以CentOS6系统为例说明）</p>
<hr>
<h2 id="1-1-第一阶段：硬件引导启动"><a href="#1-1-第一阶段：硬件引导启动" class="headerlink" title="1.1. 第一阶段：硬件引导启动"></a>1.1. 第一阶段：硬件引导启动</h2><ol>
<li>首先是BIOS加电自检，BIOS寻找启动介质，是硬盘还是光盘或者是其他启动介质。</li>
<li>找到启动介质后，在该介质中找到MBR。<ul>
<li>MBR是启动介质（比如硬盘）的第一个分区的第一个扇区，大小为512字节。</li>
<li>其中前面的446字节是bootloader（CentOS安装的时候会在这里安装一个grub程序），紧接着64字节是分区表，最后面2字节是用来校验的，我们把它叫做55AA。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="1-2-第二阶段：grub启动引导程序"><a href="#1-2-第二阶段：grub启动引导程序" class="headerlink" title="1.2. 第二阶段：grub启动引导程序"></a>1.2. 第二阶段：grub启动引导程序</h2><ol>
<li>找到了MBR，就找到了grub，它就是一个引导程序，它会引导我们想启动的系统。（grub的配置文件是 /boot/grub/grub.conf，与/etc/grub.conf是软链接）</li>
<li>grub引导分为两个阶段：执行stage1和stage2。<ul>
<li>stage1是直接放在MBR中的，也就是前面446字节里面。</li>
<li>stage2比较大，所以被放在了文件系统里。</li>
<li>对于目前较新的文献系统（如ext4）来说，stage2是不能识别到的，所以在执行完stage1后，需要借助于一个中间桥梁stage1_5来识别stage2所在的文件系统，然后再执行stage2。</li>
<li>执行完stage2后，它就会去解析grub的配置文件 /boot/grub/grub.conf，在该配置文件中它又找到了内核和内核映像（initrd）的位置。</li>
</ul>
</li>
</ol>
<hr>
<h2 id="1-3-第三阶段：内核引导"><a href="#1-3-第三阶段：内核引导" class="headerlink" title="1.3. 第三阶段：内核引导"></a>1.3. 第三阶段：内核引导</h2><ol>
<li>内核和内核映像（initrd）找到了，所以内核接管掌控权</li>
<li>按理说内核能够识别到几乎所有的硬件设备，但实际上内核的身材是非常小的，它只含有最基本的硬件驱动，而其它的常见硬件驱动是放在 initrd 中的。</li>
<li>所以这个阶段，initrd先释放到内存中，临时构成一个只读的文件系统，在这个只读的文件系统中，内核去执行临时文件系统里面的init进程，目的是加载各种硬件的驱动。</li>
<li>当所需的驱动加载完后，内核才挂载真正的根文件系统，内核把控制权交给了/sbin/init进程。</li>
</ol>
<hr>
<h2 id="1-4-第四阶段：系统初始化阶段"><a href="#1-4-第四阶段：系统初始化阶段" class="headerlink" title="1.4. 第四阶段：系统初始化阶段"></a>1.4. 第四阶段：系统初始化阶段</h2><p>/sbin/init 进程是系统其它所有进程的父进程，当它接管了系统的控制权后，首先会去读取/etc/inittab配置文件来执行相应的脚本进行系统初始化，如设置键盘、字体，装载模块，设置网络等。主要包括以下工作：</p>
<ol>
<li>执行系统初始化脚本（/etc/rc.d/rc.sysinit），对系统进行基本的配置，以读写方式挂载根文件系统及其它文件系统，到此系统算是基本运行起来了，后面需要进行运行级别的确定及相应服务的启动。rc.sysinit所做的事情（不同的Linux发行版，该文件可能有些差异）如下：<ul>
<li>获取网络环境与主机类型。首先会读取网络环境配置文件（/etc/sysconfig/network），获取主机名与默认网关等网络环境。</li>
<li>测试与载入内存设备 /proc、 /sys 及 usb设备。除了/proc 外，系统会主动检测是否有usb设备，并主动加载usb驱动，尝试载入usb文件系统。 </li>
<li>决定是否启动SELinux。</li>
<li>接口设备的检测与即插即用（PNP）参数的测试。</li>
<li>用户自定义模块的加载。用户可以在 /etc/syscongfig/*.modules 加入自定义的模块，此时它会加载到系统中。</li>
<li>加载核心的相关设置。按 /etc/sysctl.conf 这个配置文件的设置值配置功能。</li>
<li>设置系统时间（clock）。</li>
<li>设置终端的控制台字形。</li>
<li>设置 raid 及 LVM 等硬盘功能。</li>
<li>检验磁盘文件系统。</li>
<li>进行磁盘配额 quota 的转换。</li>
<li>重新以读取模式载入系统磁盘。</li>
<li>启动 quota 功能。</li>
<li>启动系统随机数设备（产生随机数功能）。</li>
<li>清除启动过程中的临时文件。</li>
<li>将启动信息加载到 /var/log/dmesg 日志文件中。</li>
<li>==》当 /etc/rc.d/rc.sysinit 执行完后，系统就可以顺利工作了，只是还需要启动系统所需要的各种服务，这样主机才可以提供相关的网络和主机功能，因此会执行下面的脚本。</li>
</ul>
</li>
<li>执行 /etc/rc.d/rc 脚本。<ul>
<li>该文件定义了服务启动的顺序是先K后S，而具体的每个运行级别的服务状态是放在 /etc/rc.d/rc*.d（*代表启动级别0~6）目录下，所有的文件均是指向/etc/init.d下相应文件的软链接。</li>
<li>rc.sysinit 通过分析 /etc/inittab 文件来确定系统的启动级别，然后才去执行 /etc/rc.d/rc*.d 下的文件。</li>
<li>注意：也就是说，/etc/目录下的 init.d、rc、rc*.d、rc.local和rc.sysinit 均是指向 /etc/rc.d 目录下相应文件和目录的软链接。我们以启动级别3为例来简要说一下：<ul>
<li>/etc/rc.d/rc3.d目录下的内容都是以S或者K开头的软链接文件，它们都链接到/etc/rc.d/init.d目录下的各种shell脚本。</li>
<li>S表示启动时需 start 的服务内容，K表示关机时需关闭的服务内容。</li>
<li>/etc/rc.d/rc*.d 中的系统服务会在系统后台启动，如果要对某个运行级别中的服务进行更具体的定制，通过 chkconfig 命令来操作，或者通过 setup、ntsys、system-config-services 来进行定制。</li>
<li>如果我们需要自己增加启动的内容，可以在init.d目录中增加相关的shell脚本，然后在rc*.d目录中建立指向该shell脚本的软链接文件即可。</li>
<li>这些shell脚本的启动或结束顺序是由S或K字母后面的数字决定，数字越小的脚本越优先执行。例如：/etc/rc.d/rc3.d/S01sysstat 就比 /etc/rc.d/rc3.d/S99local 先执行。</li>
</ul>
</li>
</ul>
</li>
<li>执行用户自定义引导程序 /etc/rc.d/rc.local。<ul>
<li>其实当执行 /etc/rc.d/rc3.d/S99local时，它就是在执行/etc/rc.d/rc.local。前一个文件是后一个文件的软链接。</li>
<li>一般来说，自定义的程序，只需要将命令放在rc.local里面就可以了，这个shell脚本就是保留给用户自定义启动内容的。</li>
</ul>
</li>
<li>完成了系统所有的启动任务后，Linux会启动终端或X-Window来等待用户登陆。<ul>
<li>tty1、tty2、tty3……这表示在运行等级1，2，3，4的时候，都会执行 /sbin/mingetty，而且执行了六个，所以Linux会有六个纯文本终端，mingetty就是启动终端的命令。</li>
<li>除了这6个之外还会执行 /etc/X11/prefdm-nodaemon ，它主要启动X-Window。</li>
<li>至此，系统就完全启动完毕了。</li>
</ul>
</li>
</ol>
<hr>
<h1 id="2-系统启动流程的示意图"><a href="#2-系统启动流程的示意图" class="headerlink" title="2. 系统启动流程的示意图"></a>2. 系统启动流程的示意图</h1><h2 id="Linux系统启动流程简图"><a href="#Linux系统启动流程简图" class="headerlink" title="- Linux系统启动流程简图"></a>- Linux系统启动流程简图</h2><p><img src="http://ooww3ll01.bkt.clouddn.com/image/png/Linux%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E7%AE%80%E5%9B%BE.png" alt="Linux启动流程简图"></p>
<h2 id="Linux系统启动流程详图"><a href="#Linux系统启动流程详图" class="headerlink" title="- Linux系统启动流程详图"></a>- Linux系统启动流程详图</h2><p><img src="http://ooww3ll01.bkt.clouddn.com/image/png/Linux%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E5%9B%BE.png" alt="Linux启动流程详图"></p>
<hr>
<h1 id="3-grub的配置文件"><a href="#3-grub的配置文件" class="headerlink" title="3. grub的配置文件"></a>3. grub的配置文件</h1><h2 id="3-1-grub配置文件说明"><a href="#3-1-grub配置文件说明" class="headerlink" title="3.1. grub配置文件说明"></a>3.1. grub配置文件说明</h2><p>grub的配置文件是 /etc/grub.conf，它的基本配置说明如下：</p>
<ul>
<li>default=0（1，2……）表示默认启动那个选项，可自定义</li>
<li>timeout=5 表示等待几秒进入默认的选项，可自定义</li>
<li>title后面的内容表示每个选项的标题，也就是在开机时候的各个选项的名字，可自定义</li>
<li>启动参数，最好不要改，改错了，就进不去系统了</li>
</ul>
<h2 id="3-2-grub加密"><a href="#3-2-grub加密" class="headerlink" title="3.2. grub加密"></a>3.2. grub加密</h2><ol>
<li>不加密密码的设置方式</li>
</ol>
<ul>
<li>在/etc/grub.conf配置文件中的title那行的上面添加一行”password=密码”即可</li>
</ul>
<ol>
<li>加密密码的设置方式</li>
</ol>
<ul>
<li><code>grub-md5-crypt</code></li>
<li><code>grub-crypt --md5|--sha-256|--sha-512</code></li>
<li>用以上的命令来获得加密的密码，然后将其复制到/etc/grub.conf文件中的”password –md5|–sha-256|–sha-512 加密的密码”即可</li>
<li>说明：–md5|–sha-256|–sha-512 这三种只选一种即可</li>
</ul>
<blockquote>
<p>OK</p>
</blockquote>
</div><div class="tags"></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2017/08/26/Linux/003. 远程连接Linux主机/" class="pre">远程连接Linux主机</a><a href="/2017/08/26/Linux/001. Linux配置静态IP联网/" class="next">Linux配置静态IP联网</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Linux系统的启动流程"><span class="toc-text">1. Linux系统的启动流程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-第一阶段：硬件引导启动"><span class="toc-text">1.1. 第一阶段：硬件引导启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-第二阶段：grub启动引导程序"><span class="toc-text">1.2. 第二阶段：grub启动引导程序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-第三阶段：内核引导"><span class="toc-text">1.3. 第三阶段：内核引导</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-第四阶段：系统初始化阶段"><span class="toc-text">1.4. 第四阶段：系统初始化阶段</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-系统启动流程的示意图"><span class="toc-text">2. 系统启动流程的示意图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux系统启动流程简图"><span class="toc-text">- Linux系统启动流程简图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Linux系统启动流程详图"><span class="toc-text">- Linux系统启动流程详图</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-grub的配置文件"><span class="toc-text">3. grub的配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-grub配置文件说明"><span class="toc-text">3.1. grub配置文件说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-grub加密"><span class="toc-text">3.2. grub加密</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/19/Linux/012. 正则表达式实用技术/">正则表达式实用技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/19/Linux/011. Linux计划任务管理技术/">Linux计划任务管理技术</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/29/Tool/007. 《Vim实用技巧》-开始：Vim解决问题的方式/">《Vim实用技巧》-开始：Vim解决问题的方式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/28/Tool/006. Vim的语言性思维/">Vim的语言性思维</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/27/Tool/005. Vim的配置/">Vim的配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/26/Tool/004. Vim的一些问题总结/">Vim的一些问题总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/转载/003. 入门Linux运维工程师需要学习的内容/">入门Linux运维工程师需要学习的内容</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/转载/002. C和C++高手修炼之路/">C和C++高手修炼之路</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/25/Tool/003. Vim初学笔记/">Vim初学笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/19/Tool/002. 常用便携软件/">常用便携软件</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reading/">Reading</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tool/">Tool</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Server/">服务</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Zhuanzai/">转载</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li></ul></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">奇怪先生theshu.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>