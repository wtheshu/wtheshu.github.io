<!DOCTYPE html>




<html class="theme-next mist" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-mac-osx.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.4">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.4" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="Linux," />


<meta name="description" content="GO  这部分知识在日常工作中用的并不多，但是这些都是属于基础知识，也必须要掌握。 1. 认识 /etc/passwd 和 /etc/shadow这两个文件是Linux系统中最重要的文件之一。注意，Linux系统关于像这两个与用户和组有关的文件，都会在相应的目录下面自动备份成相应的名字后面加-，如：passwd- - /etc/passwd 解说每个用户都有自己的一行配置。查看该文件的内容：12">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux用户与用户组管理技术">
<meta property="og:url" content="http://www.theshu.top/2017/08/31/Linux/007. Linux用户与用户组管理技术/index.html">
<meta property="og:site_name" content="奇怪先生的博客">
<meta property="og:description" content="GO  这部分知识在日常工作中用的并不多，但是这些都是属于基础知识，也必须要掌握。 1. 认识 /etc/passwd 和 /etc/shadow这两个文件是Linux系统中最重要的文件之一。注意，Linux系统关于像这两个与用户和组有关的文件，都会在相应的目录下面自动备份成相应的名字后面加-，如：passwd- - /etc/passwd 解说每个用户都有自己的一行配置。查看该文件的内容：12">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-02-23T12:31:57.398Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux用户与用户组管理技术">
<meta name="twitter:description" content="GO  这部分知识在日常工作中用的并不多，但是这些都是属于基础知识，也必须要掌握。 1. 认识 /etc/passwd 和 /etc/shadow这两个文件是Linux系统中最重要的文件之一。注意，Linux系统关于像这两个与用户和组有关的文件，都会在相应的目录下面自动备份成相应的名字后面加-，如：passwd- - /etc/passwd 解说每个用户都有自己的一行配置。查看该文件的内容：12">






  <link rel="canonical" href="http://www.theshu.top/2017/08/31/Linux/007. Linux用户与用户组管理技术/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>Linux用户与用户组管理技术 | 奇怪先生的博客</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">奇怪先生的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">耳目得来终觉浅，觉知此事要躬行。</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.theshu.top/2017/08/31/Linux/007. Linux用户与用户组管理技术/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="奇怪先生theshu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head_me.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="奇怪先生的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux用户与用户组管理技术</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-31T08:38:19+08:00">2017-08-31</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>GO</p>
</blockquote>
<p>这部分知识在日常工作中用的并不多，但是这些都是属于基础知识，也必须要掌握。</p>
<h1 id="1-认识-etc-passwd-和-etc-shadow"><a href="#1-认识-etc-passwd-和-etc-shadow" class="headerlink" title="1. 认识 /etc/passwd 和 /etc/shadow"></a>1. 认识 /etc/passwd 和 /etc/shadow</h1><p>这两个文件是Linux系统中最重要的文件之一。注意，Linux系统关于像这两个与用户和组有关的文件，都会在相应的目录下面自动备份成相应的名字后面加-，如：<strong>passwd-</strong></p>
<h2 id="etc-passwd-解说"><a href="#etc-passwd-解说" class="headerlink" title="- /etc/passwd 解说"></a>- /etc/passwd 解说</h2><p>每个用户都有自己的一行配置。查看该文件的内容：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># cat /etc/passwd | head</span></div><div class="line"><span class="symbol">root:</span><span class="symbol">x:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></div><div class="line"><span class="symbol">bin:</span><span class="symbol">x:</span><span class="number">1</span><span class="symbol">:</span><span class="number">1</span><span class="symbol">:bin</span><span class="symbol">:/bin</span><span class="symbol">:/sbin/nologin</span></div><div class="line"><span class="symbol">daemon:</span><span class="symbol">x:</span><span class="number">2</span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:daemon</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/nologin</span></div><div class="line"><span class="symbol">adm:</span><span class="symbol">x:</span><span class="number">3</span><span class="symbol">:</span><span class="number">4</span><span class="symbol">:adm</span><span class="symbol">:/var/adm</span><span class="symbol">:/sbin/nologin</span></div><div class="line"><span class="symbol">lp:</span><span class="symbol">x:</span><span class="number">4</span><span class="symbol">:</span><span class="number">7</span><span class="symbol">:lp</span><span class="symbol">:/var/spool/lpd</span><span class="symbol">:/sbin/nologin</span></div><div class="line"><span class="symbol">sync:</span><span class="symbol">x:</span><span class="number">5</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:sync</span><span class="symbol">:/sbin</span><span class="symbol">:/bin/sync</span></div><div class="line"><span class="symbol">shutdown:</span><span class="symbol">x:</span><span class="number">6</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:shutdown</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/shutdown</span></div><div class="line"><span class="symbol">halt:</span><span class="symbol">x:</span><span class="number">7</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:halt</span><span class="symbol">:/sbin</span><span class="symbol">:/sbin/halt</span></div><div class="line"><span class="symbol">mail:</span><span class="symbol">x:</span><span class="number">8</span><span class="symbol">:</span><span class="number">12</span><span class="symbol">:mail</span><span class="symbol">:/var/spool/mail</span><span class="symbol">:/sbin/nologin</span></div><div class="line"><span class="symbol">operator:</span><span class="symbol">x:</span><span class="number">11</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:operator</span><span class="symbol">:/root</span><span class="symbol">:/sbin/nologin</span></div></pre></td></tr></table></figure></p>
<p>由内容可知，/etc/passwd 由”:”分割成7个字段，每个字段的具体含义如下：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户名</td>
</tr>
<tr>
<td>2</td>
<td>账号的口令标识</td>
</tr>
<tr>
<td>3</td>
<td>用户标识号，UID（0-4294967294=2^32-2）</td>
</tr>
<tr>
<td>4</td>
<td>组标识号，GID</td>
</tr>
<tr>
<td>5</td>
<td>注释说明</td>
</tr>
<tr>
<td>6</td>
<td>家目录</td>
</tr>
<tr>
<td>7</td>
<td>可用shell</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ol>
<li>用户名可以是大小写字母、数字、减号（不能出现在首位）、点或下划线，其它字符不合法。虽然用户名中可以出现点，但不建议使用，尤其是首位。另外，减号也不建议使用，容易造成混淆。</li>
<li>口令标识在该文件里是一个x。早期的Unix系统口令确实存放在这里，但基于安全因素，后来就将其存放在 /etc/shadow 中了，这里只用了一个x代替。</li>
<li>系统是通过UID来识别用户身份的。root的UID为0，如果我们创建一个用户user，并把其UID设置为0，则user和root会被系统视为同一个用户。UID的取值范围是0~65535（但实际上已经可以支持到4294967294）。CentOS 7 的普通用户标识号从1000开始。</li>
<li>组标识号的这个字段对应着 /etc/group 中的一条记录，其是 /etc/group 和 /etc/passwd 基本类似。</li>
<li>注释说明没有实际意义，只是用来备注一些关于该用户的信息，例如电话、地址等。</li>
<li>家目录的字段，就是说当用户登陆系统后所处的就是他自己的家目录。可以修改该字段，来自定义家目录。</li>
<li>允许用户登陆的shell就是在此字段来设置的。例如，/sbin/nologin 表示不允许用户登陆。这个字段的默认值是 /bin/bash</li>
</ol>
<h2 id="etc-shadow-解说"><a href="#etc-shadow-解说" class="headerlink" title="- /etc/shadow 解说"></a>- /etc/shadow 解说</h2><p>查看该文件的内容：<br><figure class="highlight dns"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># cat /etc/shadow | head</div><div class="line">root:$<span class="number">6</span>$SlsvE2F09ZCOaE2x$I71HiFKIJ1V349nJus7X8qYfryfXz9hWPcnkEHK1g88X9aXANQV2WjPXatvPcXWH4qTmcfh19.YrSEUJjWhw8/<span class="number">::0</span>:<span class="number">99999:7</span>:::</div><div class="line">bin:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">daemon:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">adm:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">lp:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">sync:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">shutdown:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">halt:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">mail:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div><div class="line">operator:*:<span class="number">17110:0</span>:<span class="number">99999:7</span>:::</div></pre></td></tr></table></figure></p>
<p>由内容可知，/etc/shadow 由”:”分割成9个字段，每个字段的具体含义如下：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>用户名，与/etc/passwd对应</td>
</tr>
<tr>
<td>2</td>
<td>用户的真正的密码。这个密码已经加密。</td>
</tr>
<tr>
<td>3</td>
<td>上次更改密码的时间戳。这个数字以1970.1.1和上次更改密码的日期为基准计算而来。</td>
</tr>
<tr>
<td>4</td>
<td>表示要过多少天才可以更改密码，默认0，表示不受限制</td>
</tr>
<tr>
<td>5</td>
<td>表示密码多少天后到期，即在多少天内必须更改密码。例如，这里设置成30，则30天内必须要更改一次密码；否则，将不能登陆系统。默认99999，可以理解为永远不需要改</td>
</tr>
<tr>
<td>6</td>
<td>表示密码到期前的警告期限。若这个值设置为7，则表示当7天后密码过期时，系统就发出警告，提醒用户他的密码将在7天后过期</td>
</tr>
<tr>
<td>7</td>
<td>表示账号的失效期限。如果这个值设置为3，则表示密码已经到期，然而用户并没有在密码到期前修改密码，那么再过3天，这个账号便失效，即锁定</td>
</tr>
<tr>
<td>8</td>
<td>表示该账号的生命周期。和第3个字段一样，这个周期是按距离1970.1.1多少天换算的。它的含义是，账号在这个日期前可以使用，到期后账号将作废。</td>
</tr>
<tr>
<td>9</td>
<td>作为保留用的，没有什么意义</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ol>
<li>密码，默认用SHA-512加密过的，且不可逆解密<ul>
<li>$1 : MD5加密</li>
<li>$5 : SHA-256加密</li>
<li>$6 : SHA-512加密</li>
<li>!! : 表示用户未设置密码</li>
<li><ul>
<li>: 表示用户被锁定</li>
</ul>
</li>
</ul>
</li>
</ol>
<h1 id="2-用户和用户组管理"><a href="#2-用户和用户组管理" class="headerlink" title="2. 用户和用户组管理"></a>2. 用户和用户组管理</h1><p>下面的命令是用来创建、删除用户和组的，以及更改其属性的。</p>
<h2 id="groupadd"><a href="#groupadd" class="headerlink" title="- groupadd"></a>- groupadd</h2><blockquote>
<p>groupadd 用来创建用户组</p>
</blockquote>
<p>格式 <code>groupadd [-g GID] groupname</code></p>
<p>相关的配置文件为 /etc/group 和 /etc/gshadow</p>
<p>示例如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> groupadd greptest1</span></div><div class="line"><span class="meta">#</span><span class="bash"> tail -1 /etc/group</span></div><div class="line">greptest1:x:1008:</div></pre></td></tr></table></figure></p>
<p>如果不加-g选项，则按照系统默认的GID创建组。跟UID一样，GID也是从1000开始的。我们也可以按如下操作自定义GID：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># groupadd -g 1010 grouptest2</span></div><div class="line"><span class="comment"># tail -2 /etc/group</span></div><div class="line"><span class="attr">greptest1:</span><span class="attr">x:1008:</span></div><div class="line"><span class="attr">grouptest2:</span><span class="attr">x:1010:</span></div></pre></td></tr></table></figure></p>
<h2 id="groupdel"><a href="#groupdel" class="headerlink" title="- groupdel"></a>- groupdel</h2><blockquote>
<p>groupdel 用来删除用户组</p>
</blockquote>
<p>格式 <code>groupdel groupname</code></p>
<p>示例如下：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># groupdel grouptest2</span></div><div class="line"><span class="comment"># tail -2 /etc/group</span></div><div class="line"><span class="attr">mysql:</span><span class="attr">x:1007:</span></div><div class="line"><span class="attr">greptest1:</span><span class="attr">x:1008:</span></div></pre></td></tr></table></figure></p>
<p>命令groupdel没有特殊选项，但有一种情况不能删除组，如下所示：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> groupdel user1</span></div><div class="line">groupdel：不能移除用户“user1”的主组</div></pre></td></tr></table></figure></p>
<p>上例中，user1组中包含user1用户，只有在该组中移除了user1用户后才可以删除该组。</p>
<h2 id="useradd"><a href="#useradd" class="headerlink" title="- useradd"></a>- useradd</h2><blockquote>
<p>useradd 用来添加用户。</p>
</blockquote>
<p>格式 <code>useradd [-u UID] [-g GID] [-d HOME] [-M] [-s] username</code></p>
<p>相关的配置文件为 /etc/passwd 和 /etc/shadow</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>-u</td>
<td>自定义UID</td>
</tr>
<tr>
<td>-g</td>
<td>使新用户属于已经存在的某个组，后面可以跟GID，也可以跟组名</td>
</tr>
<tr>
<td>-G</td>
<td>该选项可跟多个组名，为用户指定多个扩展组</td>
</tr>
<tr>
<td>-d</td>
<td>自定义用户的家目录</td>
</tr>
<tr>
<td>-M</td>
<td>表示不建立家目录</td>
</tr>
<tr>
<td>-s</td>
<td>自定义Shell</td>
</tr>
</tbody>
</table>
<p>说明：</p>
<ul>
<li>如果useradd不加任何选项，直接跟用户名，则会创建一个跟用户名相同的组。</li>
<li>如果 -g 选项后面跟一个不存在的GID，则会报错，提示该组不存在。</li>
<li>加上 -M 选项后，则不建立用户家目录，但在/etc/passwd文件中仍然有这个字段，所以它的作用只是不创建那个目录。但是我们可以在之后为其创建家目录，并将其属主和属组的属性改为该用户：<code>chmod -R user:user /home/user/</code>；创建家目录后，还需要把相关的默认配置文件拷贝过去： <code>cp -v /etc/skel/.b* /home/username</code> 即可）</li>
</ul>
<h2 id="userdel"><a href="#userdel" class="headerlink" title="- userdel"></a>- userdel</h2><blockquote>
<p>userdel 用于删除用户。</p>
</blockquote>
<p>格式 <code>userdel [-r] username</code></p>
<p>说明：</p>
<ul>
<li>选项-r的作用是，当删除用户时，一并删除该用户的家目录和邮件目录。</li>
</ul>
<h2 id="usermod"><a href="#usermod" class="headerlink" title="- usermod"></a>- usermod</h2><blockquote>
<p>usermod 用于修改用户的属性</p>
</blockquote>
<p>格式 <code>usermod 选项 用户名</code></p>
<table>
<thead>
<tr>
<th>常用选项</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>-s Shell类型</td>
<td>修改用户的Shell类型</td>
</tr>
<tr>
<td>-d 家目录绝对路径</td>
<td>修改用户家目录（只修改配置文件，并没有为其创建新的家目录）</td>
</tr>
<tr>
<td>-u UID</td>
<td>修改用户的UID</td>
</tr>
<tr>
<td>-g GID</td>
<td>为用户修改主组</td>
</tr>
<tr>
<td>-G 附加组名</td>
<td>为用户添加附加组</td>
</tr>
<tr>
<td>-L</td>
<td>锁定用户的账号</td>
</tr>
<tr>
<td>-U</td>
<td>解锁用户</td>
</tr>
</tbody>
</table>
<h2 id="id"><a href="#id" class="headerlink" title="- id"></a>- id</h2><blockquote>
<p><code>id 用户名</code> 用来查看用户的UID和GID</p>
</blockquote>
<h2 id="chfn"><a href="#chfn" class="headerlink" title="- chfn"></a>- chfn</h2><blockquote>
<p>chfn 用于修改用户的finger，即/etc/passwd文件中第五个字段所显示的信息。这个命令在工作中几乎用不到。</p>
</blockquote>
<p>格式 <code>chfn username</code></p>
<h1 id="3-用户密码管理"><a href="#3-用户密码管理" class="headerlink" title="3. 用户密码管理"></a>3. 用户密码管理</h1><p>密码对于一个用户来说是非常的关键，而密码管理也是系统管理员的一项非常重要的任务。</p>
<h2 id="密码设置的规则"><a href="#密码设置的规则" class="headerlink" title="- 密码设置的规则"></a>- 密码设置的规则</h2><p>创建用户后，默认是没有设置密码的，只有设置好密码后，才可以登陆系统。为了安全，在为用户创建密码时，应该遵循一些密码设置的规则，这些规则是为了密码的安全性而考虑的。</p>
<ul>
<li>长度大于10个字符</li>
<li>密码中包含大小写字母、数字以及特殊字符等</li>
<li>不规则性（即不要出现常用的单词、类似于123456这样的密码等）</li>
<li>密码中不要带有名字、电话、生日等信息</li>
</ul>
<h2 id="passwd"><a href="#passwd" class="headerlink" title="- passwd"></a>- passwd</h2><blockquote>
<p>passwd 用于设置密码。</p>
</blockquote>
<p>格式 <code>passwd [username]</code></p>
<p>说明：</p>
<ul>
<li>passwd后面不加用户名，则为自己设置密码</li>
<li>passwd后面加上用户名，则为该用户设置密码（以root身份）</li>
<li>注意：只有root才可以修改其他用户的密码，普通用户只能修改自己的密码</li>
<li><code>passwd --stdin username</code> 即可实现只输入一次密码就更改成功的效果（这在脚本中经常使用）</li>
<li><code>echo &quot;密码字符串&quot; | passwd --stdin username</code> 即可实现将用户的密码直接设置为密码字符串</li>
<li><code>echo -e &quot;密码字符串第一遍\n密码字符串第二遍\n&quot;  | passwd username</code>  也可实现上面的功能</li>
</ul>
<h2 id="mkpasswd"><a href="#mkpasswd" class="headerlink" title="- mkpasswd"></a>- mkpasswd</h2><blockquote>
<p>mkpasswd 用于生成密码。</p>
</blockquote>
<p>若是Linux没有这个命令，则需要安装一下expect： <code>yum install -y expect</code>。</p>
<table>
<thead>
<tr>
<th>常用选项</th>
<th>选项说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>-l 数字</td>
<td>指定生成密码的长度</td>
</tr>
<tr>
<td>-s 数字</td>
<td>指定特殊字符的个数</td>
</tr>
<tr>
<td>-d 数字</td>
<td>指定数字的个数</td>
</tr>
</tbody>
</table>
<h1 id="4-用户身份切换"><a href="#4-用户身份切换" class="headerlink" title="4. 用户身份切换"></a>4. 用户身份切换</h1><h2 id="查看当前用户"><a href="#查看当前用户" class="headerlink" title="- 查看当前用户"></a>- 查看当前用户</h2><ul>
<li><code>who am i</code> 用于查看当前登陆的用户身份、登陆终端、登陆时间和来源IP</li>
<li><code>whoami</code> 用于查看当前登陆的用户的名字</li>
<li><code>w</code> 用于查看当前登陆系统的用户的详细信息</li>
</ul>
<h2 id="su"><a href="#su" class="headerlink" title="- su"></a>- su</h2><blockquote>
<p>su 用于切换用户身份。</p>
</blockquote>
<p>格式 <code>su [-] [username]</code></p>
<p>说明：</p>
<ul>
<li>su 的后面可以跟-，也可以不跟。加上-，即表示完整切换用户身份，即环境变量也切换过来</li>
<li>普通用户的su命令不加username，表示切换到root身份，需要输入root的密码才能成功切换</li>
<li>root用此命令切换身份时，不需要输入该用户的密码</li>
<li><code>su -c &quot;命令&quot; 用户名</code>  用该用户的身份执行命令（这在以后写脚本的时候会用到）</li>
</ul>
<h2 id="sudo"><a href="#sudo" class="headerlink" title="- sudo"></a>- sudo</h2><blockquote>
<p>sudo 用于使用root身份执行一条命令。</p>
</blockquote>
<ul>
<li>用su可以切换用户身份，而且每个普通用户都能切换到root身份。如果某个用户不小心泄露了root的密码，那岂不是系统非常不安全？为了改进这个问题，Linux系统工程师设计了sudo这个命令。</li>
<li>使用sudo命令执行一个只有root才能执行的命令是可以办到的，但是需要输入密码。这个密码并不是root的密码，而是用户自己的密码。默认情况下，只有root用户能使用sudo命令，普通用户想要使用sudo，是需要root预先设定的。</li>
<li>可以使用<code>visudo</code>命令编辑相关的配置文件/etc/sudoers。如果没有visudo这个命令，则需安装<code>yum install -y sudo</code></li>
</ul>
<p>默认root支持sudo，是因为在配置文件/etc/sudoers中有一行 <code>root ALL=(ALL) ALL</code>。在改行下面添加一行 <code>test ALL=(ALL) ALL</code>，就可以让test用户拥有使用sudo的特权。这行配置的含义如下：</p>
<table>
<thead>
<tr>
<th>段数</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>第一段</td>
<td>用户名，指定让哪个用户有sudo特权</td>
</tr>
<tr>
<td>第二段</td>
<td>ALL=（ALL），左边的ALL指的是所有的主机，右边的ALL指的是获取哪个用户的身份。第二段几乎都不用配置</td>
</tr>
<tr>
<td>第三段</td>
<td>设定可以使用sudo执行的命令有哪些</td>
</tr>
</tbody>
</table>
<p>一个例子：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aming   ALL=(root)   <span class="string">NOPASSWD:</span> <span class="regexp">/bin/</span>ls, <span class="regexp">/bin/</span>su</div></pre></td></tr></table></figure></p>
<p>上面例子的意思是：不允许aming用户修改root的密码，且切换root用户时不需要输入root密码）</p>
<p>如果每增加一个用户就设置一行，这样太麻烦了，所以可以这样设置：把<code>#wheel ALL=(ALL) ALL</code>前面的#去掉，让这一行生效。它的意思是，wheel这个组的所有用户都拥有了使用sudo的权利。接下来，只要把需要设置sudo权限的用户加入到wheel这个组中即可。</p>
<h2 id="关于sudo命令的一个很实用的案例"><a href="#关于sudo命令的一个很实用的案例" class="headerlink" title="- 关于sudo命令的一个很实用的案例"></a>- 关于sudo命令的一个很实用的案例</h2><p>需求：只允许使用普通账户登陆，并且普通用户登陆后，可以不用输入密码就能用sudo切换到root身份。</p>
<p>实现方法：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># visudo</span></div><div class="line"></div><div class="line">然后在文件的最后加入如下三行：</div><div class="line"></div><div class="line">User_Alias <span class="attr">USER_SU</span> = test,test1,aming</div><div class="line">Cmnd_Alias <span class="attr">SU</span> = /usr/bin/su</div><div class="line">USER_SU <span class="attr">ALL=(ALL)</span> NOPASSWD:SU</div></pre></td></tr></table></figure></p>
<p>说明：</p>
<ul>
<li>第一行设置了一个user的别名，USER_SU相当于test、test1和aming三个用户。可以写多个用户</li>
<li>第二行设定了一个命令别名，SU相当于/usr/bin/su，可以写多个命令</li>
<li>第三行就是类似于 <code>root ALL=(ALL) ALL</code> 这条配置语句。其中NOPASSWD的意思是：普通用户使用sudo时，不需要输入自己的密码</li>
</ul>
<p>注意：这种配置方法有一个问题，就是普通用户可以使用<code>su -</code>命令切换到root账户，然后他可以再修改root的密码就能直接登陆root了。还有一个更好的办法，那就是下面的”不允许root远程登陆Linux”</p>
<h2 id="不允许root远程登陆Linux"><a href="#不允许root远程登陆Linux" class="headerlink" title="- 不允许root远程登陆Linux"></a>- 不允许root远程登陆Linux</h2><p>/etc/ssh/sshd_config 为sshd服务的配置文件，默认允许root用户通过ssh远程登陆Linux。要想不允许root用户远程登陆Linux，具体的操作方法为：</p>
<ol>
<li>修改配置文件/etc/ssh/sshd_config</li>
<li>在配置文件中查找 <code>#PermitRootLogin yes</code> 并把它修改为 <code>PermitRootLogin no</code></li>
<li>保存配置文件后，需要重启sshd服务：<code>systemctl restart sshd.service</code></li>
</ol>
<p>注意：这个方法只适用于通过ssh远程登陆Linux的情况。</p>
<p>补充一个小知识：/etc/ssh/sshd_config（ 为 sshd 服务的配置文件）中，将<code>#UseDNS yes</code> 改成 <code>UseDNS no</code> ，即可实现在远程登陆时的等待问题。</p>
<blockquote>
<p>OK</p>
</blockquote>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/08/26/Linux/006. Linux文件与目录管理技术/" rel="next" title="Linux文件与目录管理技术">
                <i class="fa fa-chevron-left"></i> Linux文件与目录管理技术
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/31/Linux/008. Linux磁盘管理技术/" rel="prev" title="Linux磁盘管理技术">
                Linux磁盘管理技术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head_me.jpg"
                alt="奇怪先生theshu" />
            
              <p class="site-author-name" itemprop="name">奇怪先生theshu</p>
              <p class="site-description motion-element" itemprop="description">奇怪先生的博客</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">6</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/thewanghongshu" target="_blank" title="Weibo"><i class="fa fa-fw fa-globe"></i>Weibo</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-认识-etc-passwd-和-etc-shadow"><span class="nav-text">1. 认识 /etc/passwd 和 /etc/shadow</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#etc-passwd-解说"><span class="nav-text">- /etc/passwd 解说</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#etc-shadow-解说"><span class="nav-text">- /etc/shadow 解说</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-用户和用户组管理"><span class="nav-text">2. 用户和用户组管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#groupadd"><span class="nav-text">- groupadd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#groupdel"><span class="nav-text">- groupdel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#useradd"><span class="nav-text">- useradd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#userdel"><span class="nav-text">- userdel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#usermod"><span class="nav-text">- usermod</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#id"><span class="nav-text">- id</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#chfn"><span class="nav-text">- chfn</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-用户密码管理"><span class="nav-text">3. 用户密码管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#密码设置的规则"><span class="nav-text">- 密码设置的规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#passwd"><span class="nav-text">- passwd</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mkpasswd"><span class="nav-text">- mkpasswd</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-用户身份切换"><span class="nav-text">4. 用户身份切换</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#查看当前用户"><span class="nav-text">- 查看当前用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#su"><span class="nav-text">- su</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sudo"><span class="nav-text">- sudo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关于sudo命令的一个很实用的案例"><span class="nav-text">- 关于sudo命令的一个很实用的案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不允许root远程登陆Linux"><span class="nav-text">- 不允许root远程登陆Linux</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">奇怪先生theshu</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.4</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.4"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
